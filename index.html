<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>체온1도씨플러스 상담앱</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body { margin: 0; background: #f1f5f9; }
      input, textarea, select, button { font-family: system-ui, sans-serif; }
      button { cursor: pointer; }
      @media print {
        body { background: white; }
        .no-print { display: none !important; }
        .click-card:hover { background:#fff7ed; border-color:#fdba74 !important; }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      const STEM_KOR_TO_HANJA = { 갑:"甲", 을:"乙", 병:"丙", 정:"丁", 무:"戊", 기:"己", 경:"庚", 신:"辛", 임:"壬", 계:"癸" };
      const BRANCH_KOR_TO_HANJA = { 자:"子", 축:"丑", 인:"寅", 묘:"卯", 진:"辰", 사:"巳", 오:"午", 미:"未", 신:"申", 유:"酉", 술:"戌", 해:"亥" };
      const STEM_EL = { 甲:"wood",乙:"wood",丙:"fire",丁:"fire",戊:"earth",己:"earth",庚:"metal",辛:"metal",壬:"water",癸:"water" };
      const BRANCH_EL = { 子:"water",亥:"water",寅:"wood",卯:"wood",巳:"fire",午:"fire",辰:"earth",戌:"earth",丑:"earth",未:"earth",申:"metal",酉:"metal" };

      const EL_LABEL = { wood:"목(木)", fire:"화(火)", earth:"토(土)", metal:"금(金)", water:"수(水)" };
      const EL_COLOR = { wood:"#16a34a", fire:"#dc2626", earth:"#a16207", metal:"#64748b", water:"#2563eb" };
      const PRICE_TABLE = {
        trial: { label:"1회 체험", price: 70000 },
        w4: { label:"4주 11회", price: 800000 },
        w8: { label:"8주 집중", price: 1500000 },
        w12: { label:"12주 완성", price: 2000000 },
      };

      const RECO = {
        wood: { programName:"간·순환 리커버리", diet:["녹색채소","신맛 소량","야식 줄이기"], exercise:["스트레칭","요가","걷기"], heatDome:["주 3회 35~40분","복부·골반 집중"], atomy:["헤모힘","오메가3"] },
        fire: { programName:"심장·수면 밸런스", diet:["토마토","카페인 줄이기","매운맛 줄이기"], exercise:["빠른 걷기","호흡 명상","가벼운 유산소"], heatDome:["주 2~3회 30~35분","저온부터 점진"], atomy:["비타민C","칼마디"] },
        earth: { programName:"장·대사 리셋", diet:["따뜻한 음식","식이섬유","밀가루 줄이기"], exercise:["식후 걷기","스쿼트","코어"], heatDome:["주 3회 35분","복부 순환"], atomy:["프로바이오틱스","비타민B"] },
        metal: { programName:"폐·피부 디톡스", diet:["배/무","수분섭취","흡연 줄이기"], exercise:["호흡운동","가벼운 근력","걷기"], heatDome:["주 2~3회 30분","등·견갑부 중심"], atomy:["프로폴리스","비타민C"] },
        water: { programName:"신장·부종 순환", diet:["검은콩","저염식","야식 금지"], exercise:["하체 강화","골반 스트레칭","걷기"], heatDome:["주 3회 40분","하복부·허리 중심"], atomy:["홍삼","비타민B"] },
      };

      const INBODY_KEYS = { weight:"체중(kg)", muscle:"근육량(kg)", water:"체수분(L)", fatKg:"체지방량(kg)", fatPct:"체지방률(%)", phaseAngle:"위상각(°)" };

      const QUESTIONS = [
        { key:"mainSymptom", label:"어디가 가장 불편하신가요?", options:["선택", "어깨/목 결림", "허리/골반", "복부/소화", "다리 붓기", "손발 냉증", "수면/피로"] },
        { key:"coldHeat", label:"몸의 온도 느낌은 어떤가요?", options:["선택", "손발이 차다", "상체 열이 많다", "냉/열이 번갈아 있다", "보통"] },
        { key:"digestion", label:"식후 상태는 어떤가요?", options:["선택", "속이 더부룩하다", "가스/트림이 잦다", "식곤증이 심하다", "큰 불편 없음"] },
        { key:"sleep", label:"수면은 어떤 편인가요?", options:["선택", "잠들기 어렵다", "자주 깬다", "자고 나도 피곤", "수면 양호"] },
        { key:"stress", label:"스트레스/피로도는 어떤가요?", options:["선택", "매우 높다", "높다", "보통", "낮다"] },
      ];

      function parseSajuKor(raw) {
        const parts = raw.trim().split(/\s+/).filter(Boolean);
        if (parts.length !== 4) return { ok:false, error:"사주는 4개(년 월 일 시) 입력 예: 신해 기해 임인 기유" };
        const parsed = parts.map((pair) => {
          if (pair.length !== 2) return null;
          const stemKor = pair[0], branchKor = pair[1];
          const stem = STEM_KOR_TO_HANJA[stemKor];
          const branch = BRANCH_KOR_TO_HANJA[branchKor];
          if (!stem || !branch) return null;
          return { stemKor, branchKor, stem, branch, stemEl: STEM_EL[stem], branchEl: BRANCH_EL[branch] };
        });
        if (parsed.some((x) => !x)) return { ok:false, error:"천간/지지 입력을 확인해주세요." };
        return { ok:true, value: parsed };
      }

      function countElements(parsed) {
        const c = { wood:0, fire:0, earth:0, metal:0, water:0 };
        parsed.forEach((p) => { c[p.stemEl] += 1; c[p.branchEl] += 1; });
        return c;
      }

      function pickProgram(inbody) {
        if (!inbody) return PRICE_TABLE.w4;
        if (Number(inbody.phaseAngle) < 5 && Number(inbody.phaseAngle) > 0) return PRICE_TABLE.w12;
        if (Number(inbody.fatPct) >= 30) return PRICE_TABLE.w8;
        return PRICE_TABLE.w4;
      }

      function buildTrendPoints(history, metricKey) {
        const values = history.map((h) => ({ date: h.date, value: Number(h[metricKey]) })).filter((h) => Number.isFinite(h.value) && h.value > 0);
        if (values.length < 2) return null;
        const min = Math.min(...values.map((v) => v.value));
        const max = Math.max(...values.map((v) => v.value));
        const spread = max - min || 1;
        const width = 520, height = 180;
        const points = values.map((v, i) => ({ ...v, x: (i / (values.length - 1)) * (width - 40) + 20, y: height - ((v.value - min) / spread) * (height - 40) - 20 }));
        return { points, width, height };
      }

      function buildOhengComment(parsed, counts) {
        const entries = Object.entries(counts);
        const min = Math.min(...entries.map(([,v]) => v));
        const max = Math.max(...entries.map(([,v]) => v));
        const weak = entries.filter(([,v]) => v === min).map(([k]) => k);
        const strong = entries.filter(([,v]) => v === max).map(([k]) => k);

        const [year, month, day, hour] = parsed;
        const sajuSummary = `사주: ${year.stemKor}${year.branchKor}년 · ${month.stemKor}${month.branchKor}월 · ${day.stemKor}${day.branchKor}일 · ${hour.stemKor}${hour.branchKor}시`;

        const isWaterStrong = strong.includes("water");
        const isFireWeak = weak.includes("fire");
        const hasEarthPressure = counts.earth >= 2;

        const sections = [
          {
            title: "1) 핵심 구조",
            items: [
              `일간: ${day.stem}(${day.stemKor})`,
              `강한 오행: ${strong.map((k)=>EL_LABEL[k]).join(", ")}`,
              `약한 오행: ${weak.map((k)=>EL_LABEL[k]).join(", ")}`,
            ],
          },
          {
            title: "2) 수(水) 과다 체질 경향",
            items: isWaterStrong
              ? ["부종·냉증·체액대사 불균형이 반복되기 쉬움", "스트레스 시 혈압·혈당 변동이 커지기 쉬움", "생각 과다·예민·피로 누적 패턴 주의"]
              : ["수 기운이 상대적으로 약해 수분/순환 관리가 필요"]
          },
          {
            title: "3) 화(火) 부족 의미",
            items: isFireWeak
              ? ["체온·말초순환·기초대사 저하로 체중 감량이 더딜 수 있음", "피로회복이 느리고 손발이 찬 패턴이 나타날 수 있음"]
              : ["화 기운은 비교적 유지되어 대사력 저하 위험이 상대적으로 낮음"]
          },
          {
            title: "4) 건강 관리 핵심 전략",
            items: ["지속적인 체온 유지(전신온열돔 + 하체 근력)", "공복 고강도 유산소는 피하고 식후 걷기 중심", "카페인/냉음료 과다 제한, 미지근한 수분 섭취"],
          },
          {
            title: "5) 음식 방향",
            items: ["도움: 생강·계피·적색 채소·따뜻한 단백질", "주의: 냉샐러드 과다·빙과류·야간 탄수 과다"],
          },
          {
            title: "6) 결론",
            items: ["핵심은 땀만 많이 내는 것이 아니라, 지속적인 체온 상승 + 근육 유지입니다."],
          },
        ];

        if (hasEarthPressure && isWaterStrong) {
          sections.splice(3, 0, {
            title: "보충 해석",
            items: ["토(土)가 수(水)를 누르는 구조에서는 겉은 차고 속은 긴장된 패턴이 동반될 수 있습니다."],
          });
        }

        return { weak, strong, sajuSummary, sections };
      }

      function getPillarCards(parsed) {
        if (!parsed || parsed.length !== 4) return [];
        const [year, month, day, hour] = parsed;
        return [
          { title:"시주", top:hour.stem, topEl:hour.stemEl, topSub:"시간", bottom:hour.branch, bottomEl:hour.branchEl, bottomSub:"시지" },
          { title:"일주", top:day.stem, topEl:day.stemEl, topSub:"일간", bottom:day.branch, bottomEl:day.branchEl, bottomSub:"일지" },
          { title:"월주", top:month.stem, topEl:month.stemEl, topSub:"월간", bottom:month.branch, bottomEl:month.branchEl, bottomSub:"월지" },
          { title:"년주", top:year.stem, topEl:year.stemEl, topSub:"년간", bottom:year.branch, bottomEl:year.branchEl, bottomSub:"년지" },
        ];
      }

      function App() {
        const [view, setView] = useState("form");
        const [step, setStep] = useState(1);
        const [customers, setCustomers] = useState([]);
        const [searchQuery, setSearchQuery] = useState("");
        const [currentId, setCurrentId] = useState(null);
        const [name, setName] = useState("");
        const [phone, setPhone] = useState("");
        const [sajuRaw, setSajuRaw] = useState("");
        const [questionnaire, setQuestionnaire] = useState({ mainSymptom:"", coldHeat:"", digestion:"", sleep:"", stress:"" });
        const [useInbody, setUseInbody] = useState(true);
        const [inbody, setInbody] = useState({ weight:"", muscle:"", water:"", fatKg:"", fatPct:"", phaseAngle:"" });
        const [inbodyHistory, setInbodyHistory] = useState([]);
        const [trendMetric, setTrendMetric] = useState("fatPct");

        useEffect(() => {
          const historyRaw = localStorage.getItem("inbody-history");
          const customersRaw = localStorage.getItem("assessments-local");
          try {
            if (historyRaw) setInbodyHistory(JSON.parse(historyRaw));
            const list = customersRaw ? JSON.parse(customersRaw) : [];
            if (!customersRaw) localStorage.setItem("assessments-local", JSON.stringify([]));
            setCustomers(Array.isArray(list) ? list : []);
          } catch (_) {}
        }, []);

        useEffect(() => {
          localStorage.setItem("inbody-history", JSON.stringify(inbodyHistory));
        }, [inbodyHistory]);

        const parsedRes = useMemo(() => parseSajuKor(sajuRaw), [sajuRaw]);
        const parsed = parsedRes.ok ? parsedRes.value : null;
        const counts = useMemo(() => parsed ? countElements(parsed) : null, [parsed]);
        const ohengComment = useMemo(() => (parsed && counts) ? buildOhengComment(parsed, counts) : null, [parsed, counts]);

        const result = useMemo(() => {
          if (!parsed || !counts || !ohengComment) return null;
          const weakKey = ohengComment.weak[0];
          const baseReco = RECO[weakKey];
          return {
            parsed,
            counts,
            ohengComment,
            inbodyUsed: useInbody,
            program: { title: baseReco.programName, recommend: pickProgram(useInbody ? inbody : null) },
            diet: baseReco.diet,
            exercise: baseReco.exercise,
            heatDome: baseReco.heatDome,
            atomy: baseReco.atomy,
          };
        }, [parsed, counts, ohengComment, useInbody, inbody]);

        const trendData = useMemo(() => buildTrendPoints(inbodyHistory, trendMetric), [inbodyHistory, trendMetric]);

        function goStep2() {
          if (!name || !phone) return alert("이름/전화번호를 입력해 주세요.");
          if (!parsedRes.ok) return alert(parsedRes.error);
          const notAnswered = QUESTIONS.some((q) => !questionnaire[q.key] || questionnaire[q.key] === "선택");
          if (notAnswered) return alert("문진 5개 항목을 모두 선택해 주세요.");
          setStep(2);
        }

        function resetAll() {
          if (!confirm("초기화할까요?")) return;
          setView("form");
          setStep(1);
          setName("");
          setPhone("");
          setSajuRaw("");
          setQuestionnaire({ mainSymptom:"", coldHeat:"", digestion:"", sleep:"", stress:"" });
          setUseInbody(true);
          setInbody({ weight:"", muscle:"", water:"", fatKg:"", fatPct:"", phaseAngle:"" });
          setCurrentId(null);
        }

        function saveCustomer() {
          if (!result) return;
          const record = {
            id: currentId || String(Date.now()),
            updatedAt: Date.now(),
            createdAt: new Date().toISOString(),
            customer:{ name, phone },
            sajuRaw,
            sajuParsed: result.parsed,
            counts: result.counts,
            ohengComment: result.ohengComment,
            questionnaire,
            inbody: result.inbodyUsed ? inbody : null,
            recommendations: { program: result.program, diet: result.diet, exercise: result.exercise, heatDome: result.heatDome, atomy: result.atomy },
          };
          const prev = JSON.parse(localStorage.getItem("assessments-local") || "[]");
          const next = [record, ...prev.filter((x)=>x.id !== record.id)].slice(0, 100);
          localStorage.setItem("assessments-local", JSON.stringify(next));
          setCustomers(next);
          setCurrentId(record.id);
          if (result.inbodyUsed) setInbodyHistory((h) => [...h, { date: new Date().toISOString().slice(0, 10), ...inbody }].slice(-20));
          alert("✅ 로컬 저장 완료");
        }

        function loadCustomer(c) {
          setView("form");
          setStep(3);
          setCurrentId(c.id || null);
          setName(c.customer?.name || "");
          setPhone(c.customer?.phone || "");
          setSajuRaw(c.sajuRaw || "");
          setQuestionnaire(c.questionnaire || { mainSymptom:"", coldHeat:"", digestion:"", sleep:"", stress:"" });
          setUseInbody(Boolean(c.inbody));
          setInbody(c.inbody || { weight:"", muscle:"", water:"", fatKg:"", fatPct:"", phaseAngle:"" });
        }

        function deleteCustomer(id) {
          if (!confirm("이 고객 기록을 삭제할까요?")) return;
          const next = customers.filter((c)=>c.id !== id);
          localStorage.setItem("assessments-local", JSON.stringify(next));
          setCustomers(next);
        }

        const filteredCustomers = customers.filter((c) => {
          const n = c.customer?.name || "";
          const p = c.customer?.phone || "";
          return n.includes(searchQuery) || p.includes(searchQuery);
        });

        return <div style={{maxWidth:960, margin:"0 auto", padding:16, fontFamily:"system-ui"}}>
          <h1 style={{fontSize:28, fontWeight:900}}>체온1도씨플러스 상담앱</h1>
          <p style={{color:"#64748b"}}>오행상담용 문진 5개 + 사주오행 + 인바디 분석</p>

          <div className="no-print" style={{display:"flex", gap:8, marginTop:12}}>
            <button onClick={()=>{ setView("form"); setStep(1); }} style={{padding:"8px 12px", borderRadius:999, border:"1px solid #cbd5e1", background:view==="form"?"#0f172a":"white", color:view==="form"?"white":"#334155", fontWeight:800}}>신규 상담</button>
            <button onClick={()=>setView("dashboard")} style={{padding:"8px 12px", borderRadius:999, border:"1px solid #cbd5e1", background:view==="dashboard"?"#0f172a":"white", color:view==="dashboard"?"white":"#334155", fontWeight:800}}>저장 목록 ({customers.length})</button>
          </div>

          {view === "dashboard" && <div style={{marginTop:16, background:"#fff", border:"1px solid #e2e8f0", borderRadius:16, padding:16}}>
            <h2>저장된 고객 목록</h2>
            <input value={searchQuery} onChange={(e)=>setSearchQuery(e.target.value)} placeholder="이름/전화번호 검색" style={{marginTop:8, width:"100%", padding:12, borderRadius:12, border:"1px solid #cbd5e1"}} />
            <div style={{marginTop:10, display:"grid", gap:8}}>
              {filteredCustomers.length === 0 ? <div style={{color:"#64748b"}}>저장된 고객이 없습니다.</div> : filteredCustomers.map((c)=> (
                <div key={c.id} className="click-card" style={{border:"1px solid #e2e8f0", borderRadius:12, padding:12, display:"flex", justifyContent:"space-between", gap:8}}>
                  <div onClick={()=>loadCustomer(c)} style={{cursor:"pointer", flex:1}}>
                    <div style={{fontWeight:800}}>{c.customer?.name || "-"} / {c.customer?.phone || "-"}</div>
                    <div style={{fontSize:12, color:"#64748b", marginTop:4}}>{new Date(c.updatedAt || Date.now()).toLocaleString()}</div>
                  </div>
                  <button onClick={()=>deleteCustomer(c.id)} style={{padding:"8px 10px", borderRadius:10, border:"1px solid #fecaca", background:"#fef2f2", color:"#b91c1c"}}>삭제</button>
                </div>
              ))}
            </div>
          </div>}

          {view === "form" && <>
          <div className="no-print" style={{display:"flex", gap:8, marginTop:12}}>{[1,2,3].map((n) => <div key={n} style={{padding:"8px 12px", borderRadius:999, fontWeight:800, background: step===n ? "#ff6a00" : "#e2e8f0", color: step===n ? "white" : "#334155"}}>STEP {n}</div>)}</div>

          {step===1 && <div style={{marginTop:16, background:"#fff", border:"1px solid #e2e8f0", borderRadius:16, padding:16}}>
            <h2>1) 고객정보 + 사주 + 오행 문진(5문항)</h2>
            <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:12}}>
              <input value={name} onChange={(e)=>setName(e.target.value)} placeholder="고객 이름" style={{padding:12, borderRadius:10, border:"1px solid #cbd5e1"}} />
              <input value={phone} onChange={(e)=>setPhone(e.target.value)} placeholder="전화번호" style={{padding:12, borderRadius:10, border:"1px solid #cbd5e1"}} />
            </div>

            <input value={sajuRaw} onChange={(e)=>setSajuRaw(e.target.value)} placeholder="사주 예: 신해 기해 임인 기유" style={{marginTop:10, width:"100%", padding:12, borderRadius:10, border:"1px solid #cbd5e1"}} />
            {!parsedRes.ok && sajuRaw.trim() && <div style={{color:"#dc2626", marginTop:6}}>{parsedRes.error}</div>}

            <div style={{marginTop:12, padding:12, border:"1px solid #e2e8f0", borderRadius:12}}>
              <b>오행건강 문진(예시 선택)</b>
              <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:10, marginTop:8}}>
                {QUESTIONS.map((q) => (
                  <div key={q.key}>
                    <div style={{fontWeight:700, marginBottom:4}}>{q.label}</div>
                    <select value={questionnaire[q.key]} onChange={(e)=>setQuestionnaire((v)=>({...v, [q.key]:e.target.value}))} style={{width:"100%", padding:10, borderRadius:10, border:"1px solid #cbd5e1"}}>
                      {q.options.map((op) => <option key={op} value={op}>{op}</option>)}
                    </select>
                  </div>
                ))}
              </div>
            </div>

            <button onClick={goStep2} style={{marginTop:14, width:"100%", padding:12, border:"none", borderRadius:12, background:"#ff6a00", color:"white", fontWeight:900}}>다음(인바디 입력)</button>
          </div>}

          {step===2 && <div style={{marginTop:16, background:"white", border:"1px solid #e2e8f0", borderRadius:16, padding:16}}>
            <h2>2) 인바디 입력</h2>
            <div style={{display:"flex", gap:8}}>
              <button onClick={()=>setUseInbody(true)} style={{flex:1, padding:10}}>인바디 입력</button>
              <button onClick={()=>setUseInbody(false)} style={{flex:1, padding:10}}>인바디 없이</button>
            </div>
            {useInbody && <div style={{display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:10, marginTop:10}}>{Object.keys(INBODY_KEYS).map((k) => <input key={k} type="number" value={inbody[k]} onChange={(e)=>setInbody((v)=>({...v,[k]:e.target.value}))} placeholder={INBODY_KEYS[k]} style={{padding:10, borderRadius:10, border:"1px solid #cbd5e1"}} />)}</div>}
            <div style={{display:"flex", gap:8, marginTop:12}}>
              <button onClick={()=>setStep(1)} style={{flex:1, padding:12}}>이전</button>
              <button onClick={()=>setStep(3)} style={{flex:2, padding:12, background:"#ff6a00", color:"white", border:"none", borderRadius:12}}>분석 결과 보기</button>
            </div>
          </div>}

          {step===3 && result && <div style={{marginTop:16, background:"white", border:"1px solid #e2e8f0", borderRadius:16, padding:16}}>
            <h2>3) 상담 리포트</h2>
            <div>{name} / {phone}</div>

            <div style={{marginTop:12, padding:14, borderRadius:20, border:"1px solid #d7dee8", background:"#f8fafc"}}>
              <b>사주 원국</b>
              <div style={{display:"grid", gridTemplateColumns:"repeat(4, minmax(0, 1fr))", gap:10, marginTop:8}}>
                {getPillarCards(result.parsed).map((c) => (
                  <div key={c.title} style={{textAlign:"center"}}>
                    <div style={{fontSize:12, color:"#94a3b8", fontWeight:700, marginBottom:6}}>{c.title}</div>
                    <div style={{border:`3px solid ${EL_COLOR[c.topEl]}`, borderRadius:16, padding:"10px 0", background:"white"}}>
                      <div style={{fontSize:40, fontWeight:900, lineHeight:1, color:EL_COLOR[c.topEl]}}>{c.top}</div>
                      <div style={{fontSize:12, color:"#94a3b8", marginTop:4}}>{c.topSub}</div>
                    </div>
                    <div style={{height:8}} />
                    <div style={{border:`3px solid ${EL_COLOR[c.bottomEl]}`, borderRadius:16, padding:"10px 0", background:"white"}}>
                      <div style={{fontSize:40, fontWeight:900, lineHeight:1, color:EL_COLOR[c.bottomEl]}}>{c.bottom}</div>
                      <div style={{fontSize:12, color:"#94a3b8", marginTop:4}}>{c.bottomSub}</div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div style={{marginTop:12, padding:10, background:"#f8fafc", borderRadius:10}}>
              {Object.keys(result.counts).map((k)=><span key={k} style={{marginRight:10, color:EL_COLOR[k], fontWeight:700}}>{EL_LABEL[k]} {result.counts[k]}개</span>)}
            </div>

            <div style={{marginTop:8, border:"1px solid #e2e8f0", borderRadius:10, padding:10}}>
              <b>오행 건강 분석</b>
              <div style={{marginTop:6, color:"#334155", fontWeight:700}}>{result.ohengComment.sajuSummary}</div>
              <div style={{marginTop:8, display:"grid", gap:8}}>
                {result.ohengComment.sections.map((sec) => (
                  <div key={sec.title} style={{padding:8, borderRadius:8, background:"#f8fafc"}}>
                    <div style={{fontWeight:800}}>{sec.title}</div>
                    <ul style={{margin:"6px 0 0 16px", color:"#334155"}}>
                      {sec.items.map((it, i)=><li key={i}>{it}</li>)}
                    </ul>
                  </div>
                ))}
              </div>
            </div>

            <div style={{marginTop:8, border:"1px solid #e2e8f0", borderRadius:10, padding:10}}>
              <b>문진 요약</b>
              <ul style={{marginTop:8}}>
                {QUESTIONS.map((q) => <li key={q.key}>{q.label} : {questionnaire[q.key]}</li>)}
              </ul>
            </div>

            <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:10, marginTop:10}}>
              <div style={{border:"1px solid #e2e8f0", borderRadius:10, padding:10}}><b>전신온열돔 제안</b><ul>{result.heatDome.map((x,i)=><li key={i}>{x}</li>)}</ul></div>
              <div style={{border:"1px solid #e2e8f0", borderRadius:10, padding:10}}><b>애터미 건강식품 제안</b><ul>{result.atomy.map((x,i)=><li key={i}>{x}</li>)}</ul></div>
            </div>

            {inbodyHistory.length > 1 && <div style={{marginTop:12, border:"1px solid #e2e8f0", borderRadius:10, padding:10}}>
              <div style={{display:"flex", justifyContent:"space-between"}}><b>인바디 누적 추이</b><select value={trendMetric} onChange={(e)=>setTrendMetric(e.target.value)}>{Object.keys(INBODY_KEYS).map((k)=><option key={k} value={k}>{INBODY_KEYS[k]}</option>)}</select></div>
              {trendData ? <svg viewBox={`0 0 ${trendData.width} ${trendData.height}`} style={{width:"100%", marginTop:8}}><polyline fill="none" stroke="#0ea5e9" strokeWidth="3" points={trendData.points.map((p)=>`${p.x},${p.y}`).join(" ")} />{trendData.points.map((p)=><circle key={p.x} cx={p.x} cy={p.y} r="4" fill="#0284c7" />)}</svg> : <div>2회 이상 저장 시 그래프 표시</div>}
            </div>}

            <div style={{marginTop:10, padding:10, background:"#0f172a", color:"white", borderRadius:10}}>
              추천: {result.program.title} / {result.program.recommend.label} {result.program.recommend.price.toLocaleString()}원
            </div>
            <div className="no-print" style={{display:"flex", gap:8, marginTop:12}}>
              <button onClick={()=>window.print()} style={{flex:1, padding:12}}>인쇄/PDF</button>
              <button onClick={saveCustomer} style={{flex:1, padding:12, background:"#16a34a", color:"white", border:"none", borderRadius:10}}>고객 저장</button>
              <button onClick={resetAll} style={{flex:1, padding:12}}>리셋</button>
            </div>
          </div>}
        </> }
        </div>;
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
