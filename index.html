<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²œì¼ë„+ v3.1 - ì†¡ì€ìˆ™ ì›ì¥ë‹˜ ì „ìš©</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --accent: #e74c3c; --bg: #f8f9fa; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        nav { background: var(--primary); color: white; padding: 15px; display: flex; gap: 20px; position: sticky; top: 0; z-index: 100; }
        .nav-item { cursor: pointer; padding: 10px 20px; border-radius: 5px; font-weight: bold; }
        .nav-item.active { background: var(--secondary); }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h2 { color: var(--primary); border-left: 5px solid var(--secondary); padding-left: 10px; font-size: 18px; margin-bottom: 20px; }
        .q-text { font-weight: 500; margin-bottom: 8px; color: #444; display: block; font-size: 15px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 15px; margin-bottom: 12px; }
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn { border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        .btn-blue { background: var(--secondary); color: white; flex: 2; }
        .btn-gray { background: #95a5a6; color: white; flex: 1; }
        .btn-list { background: #34495e; color: white; width: 100%; text-align: left; padding: 15px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: none; border-radius: 8px; cursor: pointer; }
        .view-section { display: none; }
        .view-section.active { display: block; }
        .result-box { background: #fff; border: 2px solid var(--primary); padding: 25px; border-radius: 15px; margin-top: 15px; display: none; }
        .saju-badge { background: #eee; padding: 5px 10px; border-radius: 5px; font-weight: bold; font-size: 20px; margin: 0 3px; }
        .code-banner { background: var(--accent); color: white; padding: 15px; border-radius: 8px; text-align: center; font-size: 24px; font-weight: bold; margin: 15px 0; }
        .tea-box { background: #fff5eb; border: 1px solid #fbd38d; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .habit-box { background: #fffbe6; border: 1px solid #ffe58f; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        @media print { .no-print, nav, .btn, h2 { display: none !important; } .result-box { display: block !important; border: none; } }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" id="nav-reg" onclick="showTab('register')">ê³ ê°ì ‘ìˆ˜</div>
    <div class="nav-item" id="nav-con" onclick="showTab('consult')">ìƒë‹´ì‹¤</div>
</nav>

<div class="container">
    <section id="register" class="view-section active">
        <div class="card">
            <h2>ê¸°ì´ˆ ì •ë³´ ì…ë ¥</h2>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="name" placeholder="ì„±í•¨">
                <select id="gender" style="flex: 0.5;"><option value="ì—¬">ì—¬ì„±</option><option value="ë‚¨">ë‚¨ì„±</option></select>
            </div>
            <input type="tel" id="phone" placeholder="ì „í™”ë²ˆí˜¸ (ì˜ˆ: 010-1234-5678)">
            <input type="text" id="saju_ko" placeholder="ì‚¬ì£¼ (ì˜ˆ: ì‹ í•´ ê¸°í•´ ì„ì¸ ê¸°ìœ )">
            
            <hr style="border:0; border-top:1px solid #eee; margin: 20px 0;">
            <h2>ì²´ì§ˆ ë¬¸ì§„</h2>
            <label class="q-text">Q1. ëª©(W): ì–´ê¹¨/ëª© ê·¼ìœ¡ ë­‰ì¹¨</label>
            <select id="w_val"><option value="1">ì „í˜€ ì•„ë‹˜</option><option value="3" selected>ë³´í†µ</option><option value="5">ë§¤ìš° ì‹¬í•¨</option></select>
            <label class="q-text">Q2. í™”(H): ìƒê¸°ì—´/ë‘ê·¼ê±°ë¦¼</label>
            <select id="h_val"><option value="1">ì „í˜€ ì•„ë‹˜</option><option value="3" selected>ë³´í†µ</option><option value="5">ë§¤ìš° ì‹¬í•¨</option></select>
            <label class="q-text">Q3. í† (T): ì†Œí™”ë¶ˆëŸ‰/ìƒê°ê³¼ë‹¤</label>
            <select id="t_val"><option value="1">ì „í˜€ ì•„ë‹˜</option><option value="3" selected>ë³´í†µ</option><option value="5">ë§¤ìš° ì‹¬í•¨</option></select>
            <label class="q-text">Q4. ê¸ˆ(M): ë©´ì—­ì €í•˜/í”¼ë¶€ê±´ì¡°</label>
            <select id="m_val"><option value="1">ì „í˜€ ì•„ë‹˜</option><option value="3" selected>ë³´í†µ</option><option value="5">ë§¤ìš° ì‹¬í•¨</option></select>
            <label class="q-text">Q5. ìˆ˜(S): ë¶€ì¢…/ëƒ‰ì¦/ë¬´ê±°ì›€</label>
            <select id="s_val"><option value="1">ì „í˜€ ì•„ë‹˜</option><option value="3" selected>ë³´í†µ</option><option value="5">ë§¤ìš° ì‹¬í•¨</option></select>

            <div class="btn-group">
                <button class="btn btn-blue" onclick="saveCustomer()">ë°ì´í„° ì „ì†¡</button>
                <button class="btn btn-gray" onclick="resetForm()">ë¦¬ì…‹</button>
            </div>
        </div>
    </section>

    <section id="consult" class="view-section">
        <div class="card no-print">
            <h2>ëŒ€ê¸° ê³ ê° ì„ íƒ</h2>
            <div id="recent-list"><p>ì ‘ìˆ˜ëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
        </div>

        <div id="consult-area" style="display:none;">
            <div class="card no-print">
                <h2 id="targetDisplay">ê³ ê° ë¶„ì„</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="number" id="in1" placeholder="ì „ ì¸ë°”ë””">
                    <input type="number" id="in2" placeholder="í›„ ì¸ë°”ë””">
                </div>
                <button class="btn btn-blue" onclick="generateReport()">ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±</button>
                <button class="btn btn-gray" style="margin-top:10px;" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
            </div>

            <div id="final-report" class="result-box">
                <div style="text-align: center; margin-bottom: 10px;"><span id="res-info"></span></div>
                <div class="saju-badge-container" id="saju-hanja" style="text-align:center;"></div>
                <div class="code-banner" id="res-code"></div>
                <div class="tea-box"><strong>ğŸµ í™ì‚¼ë‹¨ ì›°ì»´ ë¶€ìŠ¤í„°</strong><br><span id="res-tea"></span></div>
                <div class="habit-box"><strong>ğŸ”® ìš´ëª…ì„ ë°”ê¾¸ëŠ” ë§ˆìŒ ìŠµê´€</strong><br><span id="res-mind"></span></div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px;">
                    <div style="background:#f8f9fa; padding:10px; border-radius:5px;"><strong>ğŸ¯ í…Œë¼í”¼</strong><br><span id="res-therapy"></span></div>
                    <div style="background:#f8f9fa; padding:10px; border-radius:5px;"><strong>ğŸ’Š ì• í„°ë¯¸ ì˜ì–‘</strong><br><span id="res-atomy"></span></div>
                </div>
                <div style="background:#eef7ff; padding:15px; border-radius:10px; border:1px solid #3498db;">
                    <strong>ğŸ’¡ ì›ì¥ë‹˜ ì „ë¬¸ ì†Œê²¬</strong><br><span id="res-ment"></span>
                </div>
                <div style="text-align:center; margin-top:20px; font-weight:bold; color:var(--primary);">"ì²´ì˜¨ 1ë„ê°€ ë‹¹ì‹ ì˜ ìš´ëª…ì„ ë°”ê¿‰ë‹ˆë‹¤."</div>
            </div>
        </div>
    </section>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAUucRqU8nciqkINbjZcUUHx3UkR_OOprs", authDomain: "cheon1do-plus.firebaseapp.com", projectId: "cheon1do-plus", storageBucket: "cheon1do-plus.firebasestorage.app", messagingSenderId: "344900999016", appId: "1:344900999016:web:a20ef3b01df68ca03928dd" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let currentCustomer = null;

    function showTab(t) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        document.getElementById(t === 'register' ? 'nav-reg' : 'nav-con').classList.add('active');
        if(t === 'consult') loadRecentCustomers();
    }

    async function saveCustomer() {
        const name = document.getElementById('name').value;
        if(!name) return alert("ì„±í•¨ì„ ì…ë ¥í•˜ì„¸ìš”.");
        const data = {
            name, gender: document.getElementById('gender').value,
            phone: document.getElementById('phone').value,
            saju_ko: document.getElementById('saju_ko').value,
            scores: { W: document.getElementById('w_val').value, H: document.getElementById('h_val').value, T: document.getElementById('t_val').value, M: document.getElementById('m_val').value, S: document.getElementById('s_val').value },
            createdAt: new Date()
        };
        await db.collection("clients").add(data);
        alert(name + "ë‹˜ ë°ì´í„° ì „ì†¡ ì™„ë£Œ!");
        resetForm();
        showTab('consult');
    }

    function resetForm() {
        document.getElementById('name').value = ""; document.getElementById('phone').value = ""; document.getElementById('saju_ko').value = "";
    }

    async function loadRecentCustomers() {
        const snap = await db.collection("clients").orderBy("createdAt", "desc").limit(5).get();
        const listDiv = document.getElementById('recent-list');
        listDiv.innerHTML = "";
        if(snap.empty) { listDiv.innerHTML = "<p>ì ‘ìˆ˜ëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.</p>"; return; }
        snap.forEach(doc => {
            const d = doc.data();
            const time = d.createdAt ? d.createdAt.toDate().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : "";
            const btn = document.createElement('button');
            btn.className = 'btn-list';
            btn.innerHTML = `<span>${d.name}(${d.gender})</span> <span style="font-size:12px; opacity:0.7;">${time} ì ‘ìˆ˜</span>`;
            btn.onclick = () => selectCustomer(doc.id, d);
            listDiv.appendChild(btn);
        });
    }

    function selectCustomer(id, data) {
        currentCustomer = { id, ...data };
        document.getElementById('consult-area').style.display = 'block';
        document.getElementById('final-report').style.display = 'none';
        document.getElementById('targetDisplay').innerText = data.name + "ë‹˜ ìƒë‹´ ì§„í–‰ì¤‘";
        window.scrollTo(0, document.getElementById('consult-area').offsetTop);
    }

    const hanjaMap = {'ì‹ ':'è¾›','í•´':'äº¥','ê¸°':'å·±','ì„':'å£¬','ì¸':'å¯…','ìœ ':'é…‰','ì':'å­','ì¶•':'ä¸‘','ë³‘':'ä¸™','ì •':'ä¸','ë¬´':'æˆŠ','ê²½':'åºš','ì„':'ä¹™','ê°‘':'ç”²','ê³„':'ç™¸','ë¯¸':'æœª','ìˆ ':'æˆŒ','ì§„':'è¾°','ì‚¬':'å·³','ì˜¤':'åˆ','ë¬˜':'å¯'};

    function generateReport() {
        const s = currentCustomer.scores;
        const maxO = Object.keys(s).reduce((a, b) => parseInt(s[a]) > parseInt(s[b]) ? a : b);
        let res = {};
        
        if(maxO === 'S') {
            res = { code: "S3R ìˆœí™˜ì •ì²´í˜•", therapy: "ì˜¨ì—´ 40ë¶„ + ì›¨ì´ë¸Œ 20ë¶„", atomy: "í—¤ëª¨í˜, ì˜¤ë©”ê°€3, ë³´ì´ì°¨", tea: "ì‚¬ì£¼ì— ìˆ˜(æ°´)ê°€ ë§ì•„ ì†ì´ ëƒ‰í•©ë‹ˆë‹¤. í™ì‚¼ë‹¨ì˜ ì˜¨ê¸°ë¡œ ì†ë¶ˆì„ ì§€í”¼ì„¸ìš”.", mind: "í˜¼ì ì°¸ëŠ” ìŠµê´€ì´ ë…ì´ ë©ë‹ˆë‹¤. ì˜¤ëŠ˜ ëª¨ë“  ê³ ë¯¼ì„ ë•€ê³¼ í•¨ê»˜ ë°°ì¶œí•˜ì„¸ìš”.", ment: "ìˆ˜ë…ì„ ë°€ì–´ë‚´ì•¼ ê¸°í˜ˆ ìˆœí™˜ì´ ì‚´ì•„ë‚©ë‹ˆë‹¤." };
        } else if(maxO === 'T') {
            res = { code: "T3M ì†Œí™”ë¶ˆëŸ‰í˜•", therapy: "ì˜¨ì—´ 30ë¶„ + ì›¨ì´ë¸Œ 30ë¶„", atomy: "í—¤ëª¨í˜, ìœ ì‚°ê· , íš¨ì†Œ", tea: "ìƒê°ì´ ë§ì•„ êµ³ì€ ìœ„ì¥ì„ í™ì‚¼ì´ ê¹¨ì›Œì¤ë‹ˆë‹¤.", mind: "ì™„ë²½ì£¼ì˜ë¥¼ ë‚´ë ¤ë†“ìœ¼ì„¸ìš”. ë‡Œê°€ ì‰¬ì–´ì•¼ ìœ„ì¥ë„ ì›€ì§ì…ë‹ˆë‹¤.", ment: "ì†ì´ í¸í•´ì•¼ ì•ˆìƒ‰ì´ ë§‘ì•„ì§‘ë‹ˆë‹¤." };
        } else if(maxO === 'W') {
            res = { code: "W1N ê·¼ìœ¡ê¸´ì¥í˜•", therapy: "ì˜¨ì—´ 40ë¶„(ì´ì™„ ëª¨ë“œ)", atomy: "í—¤ëª¨í˜, ì¹¼ë§ˆë””, ë½í‹°ì›€", tea: "ë»£ë»£í•œ ê°„ ê¸°ìš´ì„ ë¶€ë“œëŸ½ê²Œ ì´ì™„ì‹œí‚¤ëŠ” í™ì‚¼ ì²˜ë°©ì…ë‹ˆë‹¤.", mind: "ì±…ì„ê°ì„ ì ì‹œ ë‚´ë ¤ë†“ìœ¼ì„¸ìš”. ì–´ê¹¨ì˜ ì§ì„ ëœì–´ì•¼ ìš´ì´ í’€ë¦½ë‹ˆë‹¤.", ment: "ê¸´ì¥ì´ í’€ë ¤ì•¼ ë©´ì—­ë ¥ì´ ì‚´ì•„ë‚©ë‹ˆë‹¤." };
        } else {
            res = { code: "M2R ë©´ì—­ì €í•˜í˜•", therapy: "ì˜¨ì—´ 40ë¶„ + ì›¨ì´ë¸Œ 20ë¶„", atomy: "í—¤ëª¨í˜, ë¹„íƒ€ë¯¼C, ìœ ì‚°ê· ", tea: "ì•½í•´ì§„ ë°©ì–´ ê¸°ìš´ì„ ì±„ìš°ëŠ” ëª…í’ˆ í™ì‚¼ì°¨ì…ë‹ˆë‹¤.", mind: "ì™¸ë¶€ ìê·¹ì— ì˜ˆë¯¼í•´ì§„ ë§ˆìŒì„ ë‹¤ë…ì—¬ì•¼ í•  ë•Œì…ë‹ˆë‹¤.", ment: "ë¬´ë„ˆì§„ ë©´ì—­ë²½ì„ ì˜¨ì—´ë¡œ ë‹¤ì‹œ ì„¸ì›ë‹ˆë‹¤." };
        }

        document.getElementById('res-info').innerText = `${currentCustomer.name} (${currentCustomer.gender}) / ${currentCustomer.phone}`;
        document.getElementById('res-code').innerText = res.code;
        document.getElementById('res-tea').innerText = res.tea;
        document.getElementById('res-mind').innerText = res.mind;
        document.getElementById('res-therapy').innerText = res.therapy;
        document.getElementById('res-atomy').innerText = res.atomy;
        document.getElementById('res-ment').innerText = res.ment;
        
        const hanjaHTML = (currentCustomer.saju_ko || "").split(' ').map(h => `<span class="saju-badge">${hanjaMap[h] || h}</span>`).join('');
        document.getElementById('saju-hanja').innerHTML = hanjaHTML;
        document.getElementById('final-report').style.display = 'block';
    }
</script>
</body>
</html>
