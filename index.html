ã…<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²´ì˜¨1ë„ì”¨+ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ v2.5</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --accent: #e74c3c; --bg: #f8f9fa; --gold: #d4af37; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        nav { background: var(--primary); color: white; padding: 15px; display: flex; gap: 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .nav-item { cursor: pointer; padding: 10px 20px; border-radius: 5px; }
        .nav-item.active { background: var(--secondary); }
        .container { max-width: 900px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h2 { color: var(--primary); border-left: 6px solid var(--secondary); padding-left: 12px; margin-top: 0; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; }
        .btn { background: var(--secondary); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 16px; width: 100%; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: #2980b9; }
        .btn-print { background: #27ae60; margin-top: 20px; }
        .view-section { display: none; }
        .view-section.active { display: block; }

        /* ë¦¬í¬íŠ¸ ë ˆì´ì•„ì›ƒ */
        .result-box { background: #fff; border: 3px solid var(--primary); padding: 40px; border-radius: 20px; margin-top: 25px; position: relative; }
        .saju-badge-container { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .saju-badge { background: #fff; padding: 10px 15px; border-radius: 10px; font-size: 24px; font-weight: bold; border: 2px solid #eee; box-shadow: 2px 2px 5px rgba(0,0,0,0.05); color: #2c3e50; }
        .code-banner { background: var(--accent); color: white; padding: 15px; border-radius: 10px; text-align: center; font-size: 28px; font-weight: 800; margin: 20px 0; }
        
        .section-box { border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #eee; }
        .habit-box { background: #fff9db; border: 2px solid #fab005; }
        .tea-box { background: #fdf2e9; border: 2px solid #f0b27a; }
        .expert-box { background: #eef7ff; border: 2px solid #3498db; }
        
        .box-title { font-weight: bold; font-size: 19px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .info-card { background: #f8f9fa; padding: 15px; border-radius: 10px; border: 1px solid #eee; }
        .footer-msg { text-align: center; font-weight: bold; font-size: 20px; border-top: 2px dashed #ddd; padding-top: 25px; color: var(--primary); margin-top: 30px; }

        @media print {
            nav, .btn, #search-area, .no-print, h2 { display: none !important; }
            body { background: white; }
            .container { max-width: 100%; margin: 0; padding: 0; }
            .result-box { border: 2px solid #000; padding: 20px; margin: 0; border-radius: 0; }
        }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" onclick="showTab('register')">ê³ ê°ì ‘ìˆ˜(ë¬¸ì§„)</div>
    <div class="nav-item" onclick="showTab('consult')">ìƒë‹´ì‹¤(ë¶„ì„)</div>
</nav>

<div class="container">
    <section id="register" class="view-section active">
        <div class="card">
            <h2>ì‹ ê·œ ê³ ê° ë“±ë¡</h2>
            <input type="text" id="name" placeholder="ì„±í•¨">
            <input type="text" id="saju_ko" placeholder="ì‚¬ì£¼ì›êµ­ (ì˜ˆ: ì‹ í•´ ê¸°í•´ ì„ì¸ ê¸°ìœ )">
            <p><strong>[ì²´ì§ˆ ë¬¸ì§„] ì¦ìƒ ê°•ë„ (1:ë‚®ìŒ ~ 5:ë†’ìŒ)</strong></p>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div>ëª©(W) ê·¼ìœ¡ê¸´ì¥ <select id="w_val"><option>1</option><option>3</option><option>5</option></select></div>
                <div>í™”(H) ìˆœí™˜ë¶€ì¡± <select id="h_val"><option>1</option><option>3</option><option>5</option></select></div>
                <div>í† (T) ì†Œí™”ì •ì²´ <select id="t_val"><option>1</option><option>3</option><option>5</option></select></div>
                <div>ê¸ˆ(M) ë©´ì—­ì €í•˜ <select id="m_val"><option>1</option><option>3</option><option>5</option></select></div>
                <div>ìˆ˜(S) ë¶€ì¢…ëƒ‰ì¦ <select id="s_val"><option>1</option><option>3</option><option>5</option></select></div>
            </div>
            <button class="btn" style="margin-top:20px;" onclick="saveCustomer()">ë°ì´í„° ì „ì†¡</button>
        </div>
    </section>

    <section id="consult" class="view-section">
        <div class="card no-print" id="search-area">
            <h2>ê³ ê° ì¡°íšŒ</h2>
            <input type="text" id="searchName" placeholder="ì„±í•¨ ì…ë ¥">
            <button class="btn" onclick="searchCustomer()">ê²€ìƒ‰</button>
            <div id="search-result" style="margin-top:15px;"></div>
        </div>

        <div id="consult-area" style="display:none;">
            <div class="card no-print">
                <h2 id="targetName">ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="number" id="in1" placeholder="ì „ ì¸ë°”ë””">
                    <input type="number" id="in2" placeholder="í›„ ì¸ë°”ë””">
                </div>
                <button class="btn" style="background:#27ae60; margin-top:10px;" onclick="generateReport()">í†µí•© ë¶„ì„ ë° ì¶œë ¥ ì¤€ë¹„</button>
                <button class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ ë¦¬í¬íŠ¸ ì¦‰ì‹œ ì¸ì‡„</button>
            </div>

            <div id="final-report" class="result-box" style="display:none;">
                <div class="saju-badge-container" id="saju-hanja"></div>
                <div class="code-banner" id="res-code"></div>

                <div class="section-box tea-box">
                    <div class="box-title">ğŸµ ì˜¤ëŠ˜ì˜ ì›°ì»´ ë¶€ìŠ¤í„°: í™ì‚¼ë‹¨ ì˜¨ìˆ˜</div>
                    <div id="res-tea"></div>
                </div>
                
                <div class="section-box habit-box">
                    <div class="box-title">ğŸ”® ìš´ëª…ì„ ë°”ê¾¸ëŠ” ë§ˆìŒ ìŠµê´€</div>
                    <div id="res-mind"></div>
                </div>

                <div class="info-grid">
                    <div class="info-card"><strong>ğŸ¯ í…Œë¼í”¼ ì²˜ë°©</strong><br><span id="res-therapy"></span></div>
                    <div class="info-card"><strong>ğŸ’Š ì• í„°ë¯¸ ë§ì¶¤ì˜ì–‘</strong><br><span id="res-atomy"></span></div>
                </div>

                <div class="info-grid" style="margin-top:0;">
                    <div class="info-card"><strong>ğŸ¥— ê°œìš´ ì‹ë‹¨</strong><br><span id="res-diet"></span></div>
                    <div class="info-card"><strong>âœ¨ í–‰ë™ ê°œìš´ë²•</strong><br><span id="res-gaewun"></span></div>
                </div>

                <div class="section-box expert-box">
                    <div class="box-title">ğŸ’¡ ì†¡ì€ìˆ™ ì›ì¥ë‹˜ì˜ ì „ë¬¸ ì§„ë‹¨</div>
                    <div id="res-ment"></div>
                </div>

                <div class="footer-msg">"ì²´ì˜¨ 1ë„ê°€ ë‹¹ì‹ ì˜ ìš´ëª…ì„ ë°”ê¿‰ë‹ˆë‹¤."</div>
            </div>
        </div>
    </section>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAUucRqU8nciqkINbjZcUUHx3UkR_OOprs", authDomain: "cheon1do-plus.firebaseapp.com", projectId: "cheon1do-plus", storageBucket: "cheon1do-plus.firebasestorage.app", messagingSenderId: "344900999016", appId: "1:344900999016:web:a20ef3b01df68ca03928dd" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let currentCustomer = null;

    function showTab(t) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.getElementById(t).classList.add('active');
    }

    async function saveCustomer() {
        const scores = { W: document.getElementById('w_val').value, H: document.getElementById('h_val').value, T: document.getElementById('t_val').value, M: document.getElementById('m_val').value, S: document.getElementById('s_val').value };
        await db.collection("clients").add({ name: document.getElementById('name').value, saju_ko: document.getElementById('saju_ko').value, scores, createdAt: new Date() });
        alert("ë°ì´í„° ì €ì¥ ì™„ë£Œ!"); location.reload();
    }

    async function searchCustomer() {
        const snap = await db.collection("clients").where("name", "==", document.getElementById('searchName').value).get();
        const resDiv = document.getElementById('search-result'); resDiv.innerHTML = "";
        snap.forEach(doc => {
            resDiv.innerHTML += `<button class="btn" style="background:#34495e; margin-bottom:5px;" onclick="selectCustomer('${doc.id}', '${doc.data().name}', '${doc.data().saju_ko}', ${JSON.stringify(doc.data().scores)})">${doc.data().name} ì„ íƒ</button>`;
        });
    }

    function selectCustomer(id, name, saju, scores) {
        currentCustomer = { id, name, saju, scores };
        document.getElementById('search-area').style.display = 'none';
        document.getElementById('consult-area').style.display = 'block';
    }

    const hanjaMap = {'ì‹ ':'è¾›','í•´':'äº¥','ê¸°':'å·±','ì„':'å£¬','ì¸':'å¯…','ìœ ':'é…‰','ì':'å­','ì¶•':'ä¸‘','ë³‘':'ä¸™','ì •':'ä¸','ë¬´':'æˆŠ','ê²½':'åºš','ì„':'ä¹™','ê°‘':'ç”²','ê³„':'ç™¸','ë¯¸':'æœª','ìˆ ':'æˆŒ','ì§„':'è¾°','ì‚¬':'å·³','ì˜¤':'åˆ','ë¬˜':'å¯'};

    function generateReport() {
        const saju = currentCustomer.saju;
        const s = currentCustomer.scores;
        const maxO = Object.keys(s).reduce((a, b) => s[a] > s[b] ? a : b);
        let res = {};

        // í•µì‹¬ ë¡œì§: í™ì‚¼ë‹¨ ë©˜íŠ¸ ë° ìš´ëª…ìŠµê´€ ê²°í•©
        if(maxO === 'S') {
            res = { code: "S3R ìˆ˜ì •ì²´ ìˆœí™˜í˜•", therapy: "ì˜¨ì—´ 40ë¶„ + ì›¨ì´ë¸Œ 20ë¶„", atomy: "í—¤ëª¨í˜, ì˜¤ë©”ê°€3, ë³´ì´ì°¨", diet: "ê²€ì€ì½©, í•´ì¡°ë¥˜", gaewun: "ë°˜ì‹ ìš•, ë¨¸ë¦¬ ë™ìª½ ì·¨ì¹¨", tea: "ì‚¬ì£¼ì— ìˆ˜ë…(æ°´)ì´ ë§ì•„ ì†ì´ ëƒ‰í•©ë‹ˆë‹¤. í™ì‚¼ë‹¨ì˜ ë”°ëœ»í•œ ì„±ì§ˆë¡œ ì†ë¶ˆì„ ì§€í´ì•¼ ë…¸íë¬¼ì´ ì˜ ë¹ ì§‘ë‹ˆë‹¤.", mind: "<b>[ë°©ì¶œì˜ ìŠµê´€]</b> í˜¼ì ì°¸ëŠ” ìŠµê´€ì´ ëª¸ì„ ë¶“ê²Œ í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ëª¨ë“  ê³ ë¯¼ì„ ë•€ê³¼ í•¨ê»˜ ë°°ì¶œí•˜ì„¸ìš”.", ment: "ê¸°í˜ˆì˜ í˜ìœ¼ë¡œ ìˆ˜ë…ì„ ë°€ì–´ë‚¼ ë•Œ ì§„ì§œ ìˆœí™˜ì´ ì‹œì‘ë©ë‹ˆë‹¤." };
        } else if(maxO === 'T') {
            res = { code: "T3M í† ì •ì²´ ì†Œí™”í˜•", therapy: "ì˜¨ì—´ 30ë¶„ + ì›¨ì´ë¸Œ 30ë¶„", atomy: "í—¤ëª¨í˜, ìœ ì‚°ê· , íš¨ì†Œ", diet: "ë‹¨í˜¸ë°•, ì–‘ë°°ì¶”", gaewun: "ì‹í›„ ëª…ìƒ, ë…¸ë€ìƒ‰ ì†Œí’ˆ", tea: "ìƒê°ì´ ë§ì•„ ì •ì²´ëœ ê¸°ìš´ì„ í™ì‚¼ì˜ ì˜¨ê¸°ë¡œ ê¹¨ì›Œì¤ë‹ˆë‹¤. ìœ„ì¥ ìš´ë™ì„ ë•ëŠ” ë§ˆì¤‘ë¬¼ì…ë‹ˆë‹¤.", mind: "<b>[ë¹„ì›€ì˜ ìŠµê´€]</b> ì™„ë²½í•˜ë ¤ëŠ” ìƒê°ì´ ìœ„ì¥ì„ ë©ˆì¶”ê²Œ í•©ë‹ˆë‹¤. ë‡Œë¥¼ ì‰¬ê²Œ í•˜ëŠ” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.", ment: "ì†ì´ í¸ì•ˆí•´ì§€ë©´ ì–¼êµ´ì˜ ë…ì†Œì™€ ë¶“ê¸°ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ë¼ì§‘ë‹ˆë‹¤." };
        } else if(maxO === 'W') {
            res = { code: "W1N ëª©ê³¼ë‹¤ ê¸´ì¥í˜•", therapy: "ì˜¨ì—´ 40ë¶„ (ì €ê°•ë„ ì´ì™„)", atomy: "í—¤ëª¨í˜, ì¹¼ë§ˆë””, ë½í‹°ì›€", diet: "ë…¹ìƒ‰ì±„ì†Œ, ë§¤ì‹¤", gaewun: "ìˆ² ì‚°ì±…, ìŠ¤íŠ¸ë ˆì¹­", tea: "ê¸´ì¥ëœ ê°„ ê¸°ìš´ì„ ë¶€ë“œëŸ½ê²Œ ì´ì™„ì‹œí‚¤ëŠ” í™ì‚¼ ì²˜ë°©ì…ë‹ˆë‹¤. ëª¸ì„ ìœ ì—°í•˜ê²Œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.", mind: "<b>[ì´ì™„ì˜ ìŠµê´€]</b> ì±…ì„ê°ì„ ì ì‹œ ë‚´ë ¤ë†“ìœ¼ì„¸ìš”. ì–´ê¹¨ì˜ ì§ì„ ëœì–´ì•¼ ìš´ì˜ í†µë¡œê°€ ì—´ë¦½ë‹ˆë‹¤.", ment: "ê¸´ì¥ì´ í’€ë ¤ì•¼ ì²´ì˜¨ì´ ì˜¤ë¥´ê³  ë©´ì—­ì„¸í¬ê°€ í™œì„±í™”ë©ë‹ˆë‹¤." };
        } else {
            res = { code: "M2R ê¸ˆí—ˆ ë©´ì—­í˜•", therapy: "ì˜¨ì—´ 40ë¶„ + ì›¨ì´ë¸Œ 20ë¶„", atomy: "í—¤ëª¨í˜, ë¹„íƒ€ë¯¼C", diet: "ë„ë¼ì§€, ë¬´", gaewun: "ì‹¬í˜¸í¡, í°ìƒ‰ ì˜·", tea: "ì•½í•´ì§„ ë°©ì–´ ê¸°ìš´ì„ ì±„ìš°ëŠ” ëª…í’ˆ í™ì‚¼ì°¨ì…ë‹ˆë‹¤. ì‹¬ë¶€ ì˜¨ë„ë¥¼ ì˜¬ë ¤ ë©´ì—­ë ¥ì„ ë³´í˜¸í•˜ì„¸ìš”.", mind: "<b>[ë³´í˜¸ì˜ ìŠµê´€]</b> ì™¸ë¶€ ìê·¹ì— ì˜ˆë¯¼í•œ ê¸°ì§ˆì…ë‹ˆë‹¤. ë‚´ë©´ì˜ ë‹¨ë‹¨í•œ ì¤‘ì‹¬ì„ ì„¸ìš°ëŠ” ê²ƒì´ ìš°ì„ ì…ë‹ˆë‹¤.", ment: "ë¬´ë„ˆì§„ ë©´ì—­ë²½ì„ í—¤ëª¨í˜ê³¼ ì˜¨ì—´ë¡œ ë‹¤ì‹œ ê²¬ê³ í•˜ê²Œ ì„¸ì›ë‹ˆë‹¤." };
        }

        document.getElementById('res-code').innerText = res.code;
        document.getElementById('res-tea').innerText = res.tea;
        document.getElementById('res-mind').innerHTML = res.mind;
        document.getElementById('res-therapy').innerText = res.therapy;
        document.getElementById('res-atomy').innerText = res.atomy;
        document.getElementById('res-diet').innerText = res.diet;
        document.getElementById('res-gaewun').innerText = res.gaewun;
        document.getElementById('res-ment').innerText = res.ment;

        const hanjaHTML = saju.split(' ').map(s => `<div class="saju-badge">${hanjaMap[s] || s}</div>`).join('');
        document.getElementById('saju-hanja').innerHTML = hanjaHTML;
        document.getElementById('final-report').style.display = 'block';
    }
</script>
</body>
</html>
