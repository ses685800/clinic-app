<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²œì¼ë„+ v5.0 ìµœì¢…ì™„ì„±ë³¸</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --bg: #f8f9fa; --ëª©: #27ae60; --í™”: #e74c3c; --í† : #f39c12; --ê¸ˆ: #7f8c8d; --ìˆ˜: #2980b9; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        nav { background: var(--primary); color: white; padding: 15px; display: flex; gap: 20px; position: sticky; top: 0; z-index: 100; }
        .nav-item { cursor: pointer; padding: 10px 20px; border-radius: 5px; font-weight: bold; }
        .nav-item.active { background: var(--secondary); }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h2 { border-left: 5px solid var(--secondary); padding-left: 10px; font-size: 19px; margin-bottom: 20px; color: var(--primary); }
        label { font-size: 14px; color: #555; display: block; margin-bottom: 5px; font-weight: 500; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; font-size: 15px; }
        .btn-group { display: flex; gap: 10px; }
        .btn { border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; flex: 1; }
        .btn-blue { background: var(--secondary); color: white; }
        .btn-gray { background: #95a5a6; color: white; }
        .btn-list { background: #34495e; color: white; text-align: left; padding: 15px; margin-bottom: 10px; border: none; border-radius: 10px; width: 100%; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        
        /* ë¦¬í¬íŠ¸ ë””ìì¸ */
        .result-box { background: #fff; border: 2px solid #333; padding: 35px; border-radius: 20px; margin-top: 20px; display: none; }
        .saju-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
        .saju-box { background: #f9f9f9; border: 1px solid #eee; border-radius: 12px; padding: 15px 5px; text-align: center; }
        .saju-label { font-size: 12px; color: #888; margin-bottom: 5px; }
        .saju-char { font-size: 28px; font-weight: bold; }
        .bar-container { background: #eee; border-radius: 10px; height: 14px; margin: 5px 0 12px 0; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.8s; }
        .health-tip { background: #f0f7ff; padding: 18px; border-radius: 12px; border-left: 6px solid var(--secondary); margin: 20px 0; font-size: 15.5px; line-height: 1.7; }
        .atomy-box { background: #fff5f5; border: 2px solid #feb2b2; padding: 18px; border-radius: 12px; margin: 15px 0; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .item-card { background: #f8f9fa; padding: 15px; border-radius: 10px; border: 1px solid #eee; }

        @media print { .no-print, nav, .btn, h2 { display: none !important; } body { background: white; } .container { width: 100%; max-width: 100%; margin: 0; padding: 0; } .result-box { display: block !important; border: 1px solid #000; border-radius: 0; } }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" id="nav-reg" onclick="showTab('register')">1. ê³ ê°ì ‘ìˆ˜</div>
    <div class="nav-item" id="nav-con" onclick="showTab('consult')">2. ì „ë¬¸ìƒë‹´</div>
</nav>

<div class="container">
    <section id="register" class="view-section active">
        <div class="card">
            <h2>ê³ ê° ê¸°ì´ˆì •ë³´</h2>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="name" placeholder="ì„±í•¨">
                <select id="gender" style="flex:0.4;"><option value="ì—¬">ì—¬ì„±</option><option value="ë‚¨">ë‚¨ì„±</option></select>
            </div>
            <input type="tel" id="phone" placeholder="ì „í™”ë²ˆí˜¸ (010-0000-0000)">
            <input type="text" id="saju_ko" placeholder="ì‚¬ì£¼ì›êµ­ (ì˜ˆ: ì‹ í•´ ê¸°í•´ ì„ì¸ ê¸°ìœ )">
            
            <hr style="border:0; border-top:1px solid #eee; margin: 15px 0;">
            <h2>ìƒì„¸ ë¬¸ì§„</h2>
            <label>ë¶ˆí¸í•œ ê³³</label>
            <select id="mainSymptom"><option value="ì„ íƒì•ˆí•¨">ì„ íƒ</option><option>ì–´ê¹¨/ëª© ê²°ë¦¼</option><option>í—ˆë¦¬/ê³¨ë°˜</option><option>ë³µë¶€/ì†Œí™”</option><option>ë‹¤ë¦¬ ë¶“ê¸°</option><option>ì†ë°œ ëƒ‰ì¦</option><option>ìˆ˜ë©´/í”¼ë¡œ</option></select>
            <label>ëª¸ì˜ ì˜¨ë„</label>
            <select id="coldHeat"><option value="ì„ íƒì•ˆí•¨">ì„ íƒ</option><option>ì†ë°œì´ ì°¨ë‹¤</option><option>ìƒì²´ ì—´ì´ ë§ë‹¤</option><option>ëƒ‰/ì—´ êµì°¨</option><option>ë³´í†µ</option></select>
            <label>í”¼ë¡œë„</label>
            <select id="stress"><option value="ì„ íƒì•ˆí•¨">ì„ íƒ</option><option>ë§¤ìš° ë†’ìŒ</option><option>ë†’ìŒ</option><option>ë³´í†µ</option><option>ë‚®ìŒ</option></select>

            <div class="btn-group">
                <button class="btn btn-blue" onclick="saveCustomer()">ë°ì´í„° ì „ì†¡ ì™„ë£Œ</button>
                <button class="btn btn-gray" onclick="location.reload()">ë¦¬ì…‹</button>
            </div>
        </div>
    </section>

    <section id="consult" class="view-section">
        <div class="card no-print">
            <h2>ìƒë‹´ ëŒ€ê¸° ê³ ê° (ìµœê·¼ ì ‘ìˆ˜ìˆœ)</h2>
            <div id="recent-list"><p style="color:#999;">ì ‘ìˆ˜ëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
        </div>

        <div id="consult-area" style="display:none;">
            <div class="card no-print">
                <h2 id="targetDisplay">ë¶„ì„ ì§€í‘œ ì…ë ¥</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="number" id="weight" placeholder="ì²´ì¤‘(kg)">
                    <input type="number" id="phaseAngle" placeholder="ìœ„ìƒê°(Â°)">
                    <input type="number" id="fatPct" placeholder="ì²´ì§€ë°©ë¥ (%)">
                    <input type="number" id="water" placeholder="ì²´ìˆ˜ë¶„(L)">
                </div>
                <button class="btn btn-blue" onclick="generateReport()">í†µí•© ë¶„ì„ ë¦¬í¬íŠ¸ ë°œí–‰</button>
            </div>

            <div id="final-report" class="result-box">
                <div style="text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 25px;">
                    <h1 style="margin:0; font-size: 26px;">ì²œì¼ë„+ ì²´ì§ˆ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
                    <p id="res-info" style="font-size: 16px; margin-top: 10px; font-weight: bold;"></p>
                </div>

                <div class="saju-grid" id="saju-display"></div>
                <div id="graph-area" style="margin: 20px 0;"></div>
                <div id="health-ment" class="health-tip"></div>
                
                <div id="res-code" style="background:var(--í™”); color:white; padding:15px; border-radius:10px; text-align:center; font-weight:bold; font-size:20px; margin-bottom: 20px;"></div>

                <div class="info-grid">
                    <div class="item-card" style="background: #fff5eb;"><strong>ğŸµ ì›°ì»´ ë¶€ìŠ¤í„°</strong><br><span id="res-tea"></span></div>
                    <div class="item-card" style="background: #fffbe6;"><strong>ğŸ”® ë§ˆìŒ ìŠµê´€</strong><br><span id="res-mind"></span></div>
                </div>

                <div class="atomy-box">
                    <strong style="color:var(--í™”);">ğŸ’Š ì˜¤í–‰ ë§ì¶¤ ì• í„°ë¯¸ ì˜ì–‘ ì²˜ë°©</strong><br>
                    <span id="res-atomy" style="font-size: 16px; font-weight: 500; display: block; margin-top: 5px;"></span>
                </div>

                <div class="item-card" style="border-left: 5px solid var(--secondary); background: #eef7ff;">
                    <strong>ğŸ’¡ ì†¡ì€ìˆ™ ì›ì¥ë‹˜ì˜ ì „ë¬¸ ì§„ë‹¨</strong><br><span id="res-ment"></span>
                </div>

                <div style="text-align:center; margin-top:40px; font-weight:bold; font-size: 18px;">"ì²´ì˜¨ 1ë„ê°€ ë‹¹ì‹ ì˜ ìš´ëª…ì„ ë°”ê¿‰ë‹ˆë‹¤."</div>
                <button class="btn btn-gray no-print" onclick="window.print()" style="margin-top:20px;">ğŸ–¨ï¸ ë¦¬í¬íŠ¸ ì¸ì‡„í•˜ê¸°</button>
            </div>
        </div>
    </section>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAUucRqU8nciqkINbjZcUUHx3UkR_OOprs", authDomain: "cheon1do-plus.firebaseapp.com", projectId: "cheon1do-plus", storageBucket: "cheon1do-plus.firebasestorage.app", messagingSenderId: "344900999016", appId: "1:344900999016:web:a20ef3b01df68ca03928dd" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let currentCustomer = null;

    function showTab(t) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        document.getElementById(t === 'register' ? 'nav-reg' : 'nav-con').classList.add('active');
        if(t === 'consult') loadRecentCustomers();
    }

    async function saveCustomer() {
        const name = document.getElementById('name').value;
        const saju = document.getElementById('saju_ko').value;
        if(!name || !saju) return alert("ì„±í•¨ê³¼ ì‚¬ì£¼ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        
        const data = {
            name, gender: document.getElementById('gender').value,
            phone: document.getElementById('phone').value,
            saju_ko: saju,
            survey: {
                mainSymptom: document.getElementById('mainSymptom').value,
                coldHeat: document.getElementById('coldHeat').value,
                stress: document.getElementById('stress').value
            },
            createdAt: new Date()
        };
        await db.collection("clients").add(data);
        alert("ğŸ‰ " + name + "ë‹˜ ì ‘ìˆ˜ ì™„ë£Œ! ì „ë¬¸ ìƒë‹´ì‹¤ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
        showTab('consult');
    }

    async function loadRecentCustomers() {
        const snap = await db.collection("clients").orderBy("createdAt", "desc").limit(5).get();
        const listDiv = document.getElementById('recent-list');
        listDiv.innerHTML = "";
        if(snap.empty) { listDiv.innerHTML = "<p>ì ‘ìˆ˜ëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.</p>"; return; }
        snap.forEach(doc => {
            const d = doc.data();
            const time = d.createdAt ? d.createdAt.toDate().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : "";
            const btn = document.createElement('button');
            btn.className = "btn-list";
            btn.innerHTML = `<span>${d.name}(${d.gender})</span> <span>${time} ì ‘ìˆ˜</span>`;
            btn.onclick = () => { 
                currentCustomer = d; 
                document.getElementById('consult-area').style.display = 'block';
                document.getElementById('final-report').style.display = 'none';
                document.getElementById('targetDisplay').innerText = d.name + " ë‹˜ ì¸ë°”ë”” ì…ë ¥";
            };
            listDiv.appendChild(btn);
        });
    }

    const sajuMap = { 'ì‹ ':'è¾›','í•´':'äº¥','ê¸°':'å·±','ì„':'å£¬','ì¸':'å¯…','ìœ ':'é…‰','ì':'å­','ì¶•':'ä¸‘','ë³‘':'ä¸™','ì •':'ä¸','ë¬´':'æˆŠ','ê²½':'åºš','ì„':'ä¹™','ê°‘':'ç”²','ê³„':'ç™¸','ë¯¸':'æœª','ìˆ ':'æˆŒ','ì§„':'è¾°','ì‚¬':'å·³','ì˜¤':'åˆ','ë¬˜':'å¯' };
    const sajuColor = { 'è¾›':'ê¸ˆ','åºš':'ê¸ˆ','é…‰':'ê¸ˆ','ç”³':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜','ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ' };

    function generateReport() {
        const sajuParts = currentCustomer.saju_ko.split(' ');
        const hanjas = sajuParts.map(k => sajuMap[k] || k);
        const counts = { 'ëª©':0, 'í™”':0, 'í† ':0, 'ê¸ˆ':0, 'ìˆ˜':0 };
        hanjas.forEach(h => { if(sajuColor[h]) counts[sajuColor[h]]++; });

        // ì‚¬ì£¼ì¹´ë“œ í‘œì‹œ
        const sajuOrder = ['ì‹œì£¼','ì¼ì£¼','ì›”ì£¼','ë…„ì£¼'];
        document.getElementById('saju-display').innerHTML = sajuOrder.map((label, i) => `
            <div class="saju-box">
                <div class="saju-label">${label}</div>
                <div class="saju-char" style="color:var(--${sajuColor[hanjas[i*2]]})">${hanjas[i*2] || '-'}</div>
                <div class="saju-char" style="color:var(--${sajuColor[hanjas[i*2+1]]})">${hanjas[i*2+1] || '-'}</div>
            </div>`).join('');

        // ê·¸ë˜í”„ í‘œì‹œ
        document.getElementById('graph-area').innerHTML = Object.entries(counts).map(([name, count]) => {
            const pct = (count/8)*100;
            return `<div style="display:flex; justify-content:space-between; font-size:13px; font-weight:bold;"><span>${name}</span><span>${Math.round(pct)}%</span></div>
                    <div class="bar-container"><div class="bar-fill" style="width:${pct}%; background:var(--${name})"></div></div>`;
        }).join('');

        const maxGi = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
        let hMent = "", pRec = "", mind = "";
        
        if(maxGi === 'ìˆ˜') { 
            hMent = "ğŸ’§ <b>ìˆ˜(æ°´) ê¸°ìš´ ê³¼ë‹¤:</b> ì‹ ì¥ê³¼ í•˜ì²´ ìˆœí™˜ì´ ì•½í•´ì§€ê¸° ì‰¬ìš°ë©° ëª¸ì´ ì°¨ê³  ë¶“ëŠ” ìˆ˜ë… ì •ì²´ë¥¼ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì‹¬ë¶€ ì˜¨ë„ë¥¼ ë†’ì—¬ ëƒ‰ê¸°ë¥¼ ëª°ì•„ë‚´ëŠ” ê²ƒì´ ìµœìš°ì„ ì…ë‹ˆë‹¤."; 
            pRec = "í—¤ëª¨í˜, í™ì‚¼ë‹¨, ë³´ì´ì°¨, ìœ ì‚°ê· ";
            mind = "í˜¼ì ì°¸ëŠ” ìŠµê´€ì´ ëª¸ì„ ë¶“ê²Œ í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ëª¨ë“  ê³ ë¯¼ì„ ë•€ê³¼ í•¨ê»˜ ë°°ì¶œí•˜ì„¸ìš”.";
        } else if(maxGi === 'í™”') { 
            hMent = "ğŸ”¥ <b>í™”(ç«) ê¸°ìš´ ê³¼ë‹¤:</b> ì‹¬ì¥ ì—´ê°ì´ ìœ„ë¡œ ì˜¬ë¼ì™€ ë‘í†µì´ë‚˜ ê°€ìŠ´ ë‹µë‹µí•¨ì„ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒê¸°ë˜ëŠ” ì—´ì„ ë‚´ë¦¬ê³  í˜ˆí–‰ì„ ë•ëŠ” ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤."; 
            pRec = "ì˜¤ë©”ê°€3, ë½í‹°ì›€, ì¹¼ë§ˆë””, ë¹„íƒ€ë¯¼C";
            mind = "ì¡°ê¸‰í•œ ë§ˆìŒì„ ë‚´ë ¤ë†“ìœ¼ì„¸ìš”. ì²œì²œíˆ í˜¸í¡í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ìš´ì˜ íë¦„ì´ ë°”ë€ë‹ˆë‹¤.";
        } else if(maxGi === 'í† ') { 
            hMent = "â›°ï¸ <b>í† (åœŸ) ê¸°ìš´ ê³¼ë‹¤:</b> ê¸°í˜ˆ ì •ì²´ê°€ ì‰½ê²Œ ì¼ì–´ë‚˜ ì†Œí™” ë¶ˆëŸ‰ì´ë‚˜ ë§Œì„± ë¬´ê¸°ë ¥ì¦ì´ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íš¨ì†Œë¡œ ìœ„ì¥ ìš´ë™ì„ ë•ê³  í™œë™ëŸ‰ì„ ëŠ˜ë ¤ì•¼ í•©ë‹ˆë‹¤."; 
            pRec = "íŒŒì¸ìì„, ìœ ì‚°ê· , ì°¨ì „ìí”¼, í—¤ëª¨í˜";
            mind = "ì™„ë²½í•˜ë ¤ëŠ” ìƒê°ì„ ë¹„ìš°ì„¸ìš”. ë‡Œë¥¼ ì‰¬ê²Œ í•´ì•¼ ìœ„ì¥ë„ í¸ì•ˆí•˜ê²Œ ì›€ì§ì…ë‹ˆë‹¤.";
        } else if(maxGi === 'ëª©') { 
            hMent = "ğŸŒ³ <b>ëª©(æœ¨) ê¸°ìš´ ê³¼ë‹¤:</b> ê°„ ê¸°ìš´ì´ ë­‰ì¹˜ê¸° ì‰¬ì›Œ ê·¼ìœ¡ì´ ë”±ë”±í•´ì§€ê³  í”¼ë¡œë„ê°€ ë†’ìŠµë‹ˆë‹¤. ê·¼ìœ¡ ê¸´ì¥ì„ í•´ì†Œí•˜ê³  í•´ë…ì„ ë•ëŠ” ì²˜ë°©ì´ íš¨ê³¼ì ì…ë‹ˆë‹¤."; 
            pRec = "ë°€í¬ì”¨ìŠ¬, ë¹„íƒ€ë¯¼B ì»´í”Œë ‰ìŠ¤, í™ê²½ì²œ ë°€í¬ì”¨ìŠ¬";
            mind = "ì±…ì„ê°ì„ ì ì‹œ ë‚´ë ¤ë†“ìœ¼ì„¸ìš”. ì–´ê¹¨ì˜ ì§ì„ ëœì–´ì•¼ ìƒˆë¡œìš´ ë³µì´ ë“¤ì–´ì˜µë‹ˆë‹¤.";
        } else { 
            hMent = "âš”ï¸ <b>ê¸ˆ(é‡‘) ê¸°ìš´ ê³¼ë‹¤:</b> í˜¸í¡ê¸°ì™€ í”¼ë¶€ ê±´ì¡°ë¥¼ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ë©´ì—­ë ¥ì„ ë†’ì—¬ ê¸°ê´€ì§€ë¥¼ ë³´í˜¸í•˜ê³  ì²´ë‚´ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶”ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤."; 
            pRec = "ë…¸ë‹ˆ, ë¹„íƒ€ë¯¼C, ìŠ¤í”¼ë£¨ë¦¬ë‚˜, ë£¨í…Œì¸";
            mind = "ì™¸ë¶€ ìê·¹ì— ì˜ˆë¯¼í•œ ë§ˆìŒì„ ë‹¤ë…ì´ì„¸ìš”. ë‚´ë©´ì˜ ì¤‘ì‹¬ì„ ì„¸ìš°ëŠ” ê²ƒì´ ê±´ê°•ì˜ ì‹œì‘ì…ë‹ˆë‹¤.";
        }

        document.getElementById('res-info').innerText = `${currentCustomer.name} (${currentCustomer.gender}) / ${currentCustomer.phone}`;
        document.getElementById('health-ment').innerHTML = hMent;
        document.getElementById('res-atomy').innerText = pRec;
        document.getElementById('res-code').innerText = maxGi === 'ìˆ˜' ? "S3R ìˆœí™˜ì •ì²´í˜• (ì²´ì§ˆë¶€ì¢…)" : "ì˜¤í–‰ ë°¸ëŸ°ìŠ¤ ì¡°ì •í˜•";
        document.getElementById('res-tea').innerText = "ì‹¬ë¶€ ì˜¨ë„ë¥¼ ê¹¨ì›Œ ê¸°í˜ˆ ìˆœí™˜ì„ ë•ëŠ” í™ì‚¼ë‹¨ ì˜¨ìˆ˜ ì²˜ë°©";
        document.getElementById('res-mind').innerText = mind;
        document.getElementById('res-ment').innerText = `ìœ„ìƒê° ${document.getElementById('phaseAngle').value}Â° ì§„ë‹¨ ê²°ê³¼, ${currentCustomer.survey.mainSymptom} ì™„í™”ë¥¼ ìœ„í•´ ì‹¬ë¶€ ì˜¨ì—´ ê´€ë¦¬ê°€ ì ê·¹ ì¶”ì²œë©ë‹ˆë‹¤.`;
        document.getElementById('final-report').style.display = 'block';
    }
</script>
</body>
</html>
