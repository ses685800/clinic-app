<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²œì¼ë„+ v4.1 - ì˜¤í–‰ ê±´ê°• ë¦¬í¬íŠ¸</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --bg: #f8f9fa; --ëª©: #27ae60; --í™”: #e74c3c; --í† : #f39c12; --ê¸ˆ: #7f8c8d; --ìˆ˜: #2980b9; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        nav { background: var(--primary); color: white; padding: 15px; display: flex; gap: 20px; position: sticky; top: 0; z-index: 100; }
        .nav-item { cursor: pointer; padding: 8px 15px; border-radius: 5px; font-weight: bold; }
        .nav-item.active { background: var(--secondary); }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { border-left: 5px solid var(--secondary); padding-left: 10px; font-size: 18px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; font-size: 15px; }
        .saju-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
        .saju-box { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 15px 5px; text-align: center; }
        .saju-char { font-size: 28px; font-weight: bold; margin: 5px 0; }
        .bar-container { background: #eee; border-radius: 10px; height: 12px; margin: 5px 0 12px 0; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.5s; }
        .health-tip { background: #f0f4f8; padding: 15px; border-radius: 10px; border-left: 5px solid var(--secondary); margin-top: 10px; font-size: 15px; line-height: 1.6; }
        .view-section { display: none; }
        .view-section.active { display: block; }
        .btn { background: var(--secondary); color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        @media print { .no-print { display: none !important; } .container { width: 100%; } .card { box-shadow: none; border: 1px solid #eee; } }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" onclick="showTab('register')">ê³ ê°ì ‘ìˆ˜</div>
    <div class="nav-item" onclick="showTab('consult')">ì „ë¬¸ìƒë‹´</div>
</nav>

<div class="container">
    <section id="register" class="view-section active">
        <div class="card">
            <h2>ê³ ê° ì •ë³´ ë° ë¬¸ì§„</h2>
            <input type="text" id="name" placeholder="ì„±í•¨">
            <input type="text" id="saju_ko" placeholder="ì‚¬ì£¼ (ì˜ˆ: ì‹ í•´ ê¸°í•´ ì„ì¸ ê¸°ìœ )">
            <div id="survey-area"></div>
            <button class="btn" onclick="saveCustomer()">ì „ì†¡ ë° ì ‘ìˆ˜</button>
        </div>
    </section>

    <section id="consult" class="view-section">
        <div class="card no-print">
            <h2>ëŒ€ê¸° ê³ ê° ëª©ë¡</h2>
            <div id="recent-list"></div>
        </div>

        <div id="consult-area" style="display:none;">
            <div class="card no-print">
                <h2>ì¸ë°”ë”” ì§€í‘œ ì…ë ¥</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="number" id="weight" placeholder="ì²´ì¤‘(kg)">
                    <input type="number" id="phaseAngle" placeholder="ìœ„ìƒê°(Â°)">
                </div>
                <button class="btn" onclick="generateReport()">ìµœì¢… ë¶„ì„ ë¦¬í¬íŠ¸ ë°œí–‰</button>
            </div>

            <div id="final-report" class="card" style="display:none;">
                <h1 style="text-align:center; font-size: 22px; border-bottom: 2px solid #333; padding-bottom: 10px;">ì²œì¼ë„+ ì²´ì§ˆ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
                <div class="saju-grid" id="saju-display"></div>
                <div id="graph-area"></div>
                <div id="health-ment" class="health-tip"></div>
                <div id="res-code" style="background:var(--í™”); color:white; padding:15px; border-radius:10px; text-align:center; font-weight:bold; font-size:20px; margin:15px 0;"></div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div style="background:#fff5eb; padding:15px; border-radius:10px;"><strong>ğŸµ í™ì‚¼ë‹¨ ì²˜ë°©</strong><br><span id="res-tea"></span></div>
                    <div style="background:#eef7ff; padding:15px; border-radius:10px;"><strong>ğŸ’¡ ì „ë¬¸ ì†Œê²¬</strong><br><span id="res-ment"></span></div>
                </div>
                <button class="btn no-print" onclick="window.print()">ì¸ì‡„í•˜ê¸°</button>
            </div>
        </div>
    </section>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAUucRqU8nciqkINbjZcUUHx3UkR_OOprs", authDomain: "cheon1do-plus.firebaseapp.com", projectId: "cheon1do-plus", storageBucket: "cheon1do-plus.firebasestorage.app", messagingSenderId: "344900999016", appId: "1:344900999016:web:a20ef3b01df68ca03928dd" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let currentCustomer = null;

    const QUESTIONS = [
        { key:"main", label:"ê°€ì¥ ë¶ˆí¸í•œ ê³³", options:["ëª©/ì–´ê¹¨","í—ˆë¦¬","ì†Œí™”","ëƒ‰ì¦/ë¶€ì¢…"] },
        { key:"cold", label:"í‰ì†Œ ì˜¨ë„ê°", options:["ì¶¥ë‹¤","ë¥ë‹¤","ì—´ì´ì˜¬ëë‹¤ì‹ì—ˆë‹¤","ë³´í†µ"] }
    ];

    window.onload = () => {
        const area = document.getElementById('survey-area');
        QUESTIONS.forEach(q => {
            area.innerHTML += `<label style="font-size:13px;color:#666;">${q.label}</label><select id="${q.key}"><option value="">ì„ íƒ</option>${q.options.map(o=>`<option value="${o}">${o}</option>`).join('')}</select>`;
        });
    };

    function showTab(t) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        if(t === 'consult') loadRecentCustomers();
    }

    async function saveCustomer() {
        const name = document.getElementById('name').value;
        const saju = document.getElementById('saju_ko').value;
        if(!name || !saju) return alert("ì„±í•¨ê³¼ ì‚¬ì£¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        await db.collection("clients").add({ name, saju_ko: saju, createdAt: new Date() });
        alert("ì ‘ìˆ˜ ì™„ë£Œ!"); showTab('consult');
    }

    async function loadRecentCustomers() {
        const snap = await db.collection("clients").orderBy("createdAt", "desc").limit(5).get();
        const list = document.getElementById('recent-list');
        list.innerHTML = "";
        snap.forEach(doc => {
            const btn = document.createElement('button');
            btn.className = "btn"; btn.style.textAlign="left"; btn.style.background="#34495e";
            btn.innerText = `${doc.data().name} ë‹˜ ì„ íƒ`;
            btn.onclick = () => { currentCustomer = doc.data(); document.getElementById('consult-area').style.display='block'; };
            list.appendChild(btn);
        });
    }

    const sajuMap = { 'ì‹ ':'è¾›','í•´':'äº¥','ê¸°':'å·±','ì„':'å£¬','ì¸':'å¯…','ìœ ':'é…‰','ì':'å­','ì¶•':'ä¸‘','ë³‘':'ä¸™','ì •':'ä¸','ë¬´':'æˆŠ','ê²½':'åºš','ì„':'ä¹™','ê°‘':'ç”²','ê³„':'ç™¸','ë¯¸':'æœª','ìˆ ':'æˆŒ','ì§„':'è¾°','ì‚¬':'å·³','ì˜¤':'åˆ','ë¬˜':'å¯' };
    const sajuColor = { 'è¾›':'ê¸ˆ','åºš':'ê¸ˆ','é…‰':'ê¸ˆ','ç”³':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜','ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ä¸‘':'í† ','æœª':'í† ' };

    function generateReport() {
        const hanjas = currentCustomer.saju_ko.split(' ').map(k => sajuMap[k] || k);
        const counts = { 'ëª©':0, 'í™”':0, 'í† ':0, 'ê¸ˆ':0, 'ìˆ˜':0 };
        hanjas.forEach(h => { if(sajuColor[h]) counts[sajuColor[h]]++; });

        document.getElementById('saju-display').innerHTML = hanjas.map(h => `<div class="saju-box"><div class="saju-char" style="color:var(--${sajuColor[h]})">${h}</div></div>`).join('');
        
        document.getElementById('graph-area').innerHTML = Object.entries(counts).map(([name, count]) => {
            const pct = (count/8)*100;
            return `<div style="font-size:12px;">${name} (${Math.round(pct)}%)</div><div class="bar-container"><div class="bar-fill" style="width:${pct}%; background:var(--${name})"></div></div>`;
        }).join('');

        // â˜… ì˜¤í–‰ ê±´ê°• ë©˜íŠ¸ ìë™ ìƒì„±ë¶€
        let healthMent = "";
        const maxGi = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
        
        if(maxGi === 'ìˆ˜') healthMent = "ğŸ’§ <b>ìˆ˜(æ°´) ê¸°ìš´ ê³¼ë‹¤:</b> ì‹ ì¥ê³¼ í•˜ì²´ ìˆœí™˜ì´ ì•½í•´ì§€ê¸° ì‰¬ìš´ ì²´ì§ˆì…ë‹ˆë‹¤. ëª¸ì´ ì‰½ê²Œ ë¶“ê³  ì†ë°œì´ ì°¨ê°€ì›Œì§€ëŠ” ìˆ˜ë…(æ°´æ¯’) ì •ì²´ë¥¼ ì£¼ì˜í•´ì•¼ í•˜ë©°, ë”°ëœ»í•œ ì˜¨ì—´ ìš”ë²•ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.";
        else if(maxGi === 'í™”') healthMent = "ğŸ”¥ <b>í™”(ç«) ê¸°ìš´ ê³¼ë‹¤:</b> ì‹¬ì¥ ì—´ê°ì´ ìœ„ë¡œ ì˜¬ë¼ì™€ ë‘í†µì´ë‚˜ ê°€ìŠ´ ë‹µë‹µí•¨ì„ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒê¸°ë˜ëŠ” ì—´ì„ ì•„ë˜ë¡œ ë‚´ë¦¬ê³  ì‹¬ì‹ ì„ ì•ˆì •ì‹œí‚¤ëŠ” ì´ì™„ í…Œë¼í”¼ê°€ íš¨ê³¼ì ì…ë‹ˆë‹¤.";
        else if(maxGi === 'í† ') healthMent = "â›°ï¸ <b>í† (åœŸ) ê¸°ìš´ ê³¼ë‹¤:</b> ê¸°í˜ˆ ì •ì²´ê°€ ì‰½ê²Œ ì¼ì–´ë‚˜ ì†Œí™” ë¶ˆëŸ‰ì´ë‚˜ ë¬´ê¸°ë ¥ì¦ì´ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì „ì‹  ìˆœí™˜ì„ ë•ëŠ” ì›¨ì´ë¸Œ ìš”ë²•ìœ¼ë¡œ ë§‰íŒ ê¸°ìš´ì„ ëš«ì–´ì£¼ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.";
        else if(maxGi === 'ëª©') healthMent = "ğŸŒ³ <b>ëª©(æœ¨) ê¸°ìš´ ê³¼ë‹¤:</b> ê°„ ê¸°ìš´ì´ ë­‰ì¹˜ê¸° ì‰¬ì›Œ ì–´ê¹¨ì™€ ëª© ê·¼ìœ¡ì´ ëŒì²˜ëŸ¼ ë”±ë”±í•´ì§€ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ê·¼ìœ¡ ê¸´ì¥ì„ í•´ì†Œí•˜ê³  í”¼ë¡œë¥¼ í’€ì–´ì£¼ëŠ” ê´€ë¦¬ê°€ ì‹œê¸‰í•©ë‹ˆë‹¤.";
        else healthMent = "âš”ï¸ <b>ê¸ˆ(é‡‘) ê¸°ìš´ ê³¼ë‹¤:</b> í˜¸í¡ê¸°ì™€ í”¼ë¶€ê°€ ê±´ì¡°í•´ì§€ê¸° ì‰½ê³  ì˜ˆë¯¼í•œ ê¸°ì§ˆì„ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©´ì—­ë ¥ì„ ë†’ì´ê³  ì²´ë‚´ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶”ëŠ” ì²´ì˜¨ ê´€ë¦¬ê°€ ë„ì›€ë©ë‹ˆë‹¤.";

        document.getElementById('health-ment').innerHTML = healthMent;
        document.getElementById('res-code').innerText = maxGi === 'ìˆ˜' ? "S3R ìˆœí™˜ì •ì²´í˜•" : "ì²´ì§ˆ ë°¸ëŸ°ìŠ¤ ì¡°ì •í˜•";
        document.getElementById('res-tea').innerText = "ì‹¬ë¶€ ì˜¨ë„ë¥¼ ë†’ì—¬ì£¼ëŠ” í™ì‚¼ë‹¨ ì˜¨ìˆ˜ ì²˜ë°©";
        document.getElementById('res-ment').innerText = `ìœ„ìƒê° ${document.getElementById('phaseAngle').value}Â°ë¥¼ ê³ ë ¤í•œ ë§ì¶¤ í…Œë¼í”¼ ì œì•ˆ`;
        document.getElementById('final-report').style.display = 'block';
    }
</script>
</body>
</html>
