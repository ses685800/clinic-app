<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²œì¼ë„+ v7.0 ìµœì¢…ì™„ì„±</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --ëª©: #27ae60; --í™”: #e74c3c; --í† : #f39c12; --ê¸ˆ: #7f8c8d; --ìˆ˜: #2980b9; }
        body { font-family: 'Noto Sans KR', sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
        nav { background: var(--primary); color: white; padding: 15px; display: flex; gap: 10px; justify-content: center; position: sticky; top: 0; z-index: 1000; }
        .nav-item { cursor: pointer; padding: 12px 20px; border-radius: 8px; font-weight: bold; }
        .nav-item.active { background: var(--secondary); }
        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .view-section { display: none; }
        .view-section.active { display: block; }
        h2 { border-left: 5px solid var(--secondary); padding-left: 10px; font-size: 18px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; }
        .btn { border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; }
        .btn-blue { background: var(--secondary); color: white; }
        .btn-list { background: #fff; border: 1px solid #ddd; padding: 15px; margin-bottom: 8px; border-radius: 10px; width: 100%; text-align: left; display: flex; justify-content: space-between; cursor: pointer; }
        /* ì‚¬ì£¼/ê·¸ë˜í”„ ë””ìì¸ */
        .saju-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
        .saju-box { background: #f8f9fa; border: 1px solid #eee; border-radius: 10px; padding: 10px; text-align: center; }
        .saju-char { font-size: 24px; font-weight: bold; display: block; margin: 5px 0; }
        .bar-bg { background: #eee; border-radius: 10px; height: 12px; margin-bottom: 10px; }
        .bar-fill { height: 100%; border-radius: 10px; transition: width 0.5s; }
        .result-box { background: white; padding: 25px; border-radius: 15px; border: 2px solid #333; display: none; margin-top: 20px; }
        @media print { .no-print { display: none; } .result-box { display: block !important; border: 1px solid #000; } }
    </style>
</head>
<body>

<nav class="no-print">
    <div class="nav-item active" id="t-reg" onclick="showTab('register')">1. ê³ ê°ì ‘ìˆ˜</div>
    <div class="nav-item" id="t-con" onclick="showTab('consult')">2. ì „ë¬¸ìƒë‹´</div>
</nav>

<div class="container">
    <section id="register" class="view-section active">
        <div class="card">
            <h2>ê³ ê° ì •ë³´ ë“±ë¡</h2>
            <input type="text" id="name" placeholder="ì„±í•¨ ì…ë ¥">
            <select id="gender"><option value="ì—¬">ì—¬ì„±</option><option value="ë‚¨">ë‚¨ì„±</option></select>
            <input type="tel" id="phone" placeholder="ì „í™”ë²ˆí˜¸">
            <input type="text" id="saju_input" placeholder="ì‚¬ì£¼ 8ê¸€ì (ì˜ˆ: ì‹ í•´ ê¸°í•´ ì„ì¸ ê¸°ìœ )">
            <select id="symp"><option value="ì¼ë°˜">ë¶ˆí¸í•œ ê³³ ì„ íƒ</option><option>ëª©/ì–´ê¹¨</option><option>í—ˆë¦¬</option><option>ì†Œí™”</option><option>ëƒ‰ì¦</option></select>
            <button class="btn btn-blue" onclick="saveData()">ë°ì´í„° ì „ì†¡ ë° ì €ì¥</button>
        </div>
        <div class="card">
            <h2>ì‹¤ì‹œê°„ ì ‘ìˆ˜ ëª©ë¡ (ì „ì†¡ í™•ì¸ìš©)</h2>
            <div id="reg-check-list" style="font-size: 14px; color: #666;">ë°ì´í„°ë¥¼ ì „ì†¡í•˜ë©´ ì—¬ê¸°ì— ë°”ë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
        </div>
    </section>

    <section id="consult" class="view-section">
        <div class="card no-print">
            <h2>ìƒë‹´ ê³ ê° ì„ íƒ</h2>
            <div id="consult-list"></div>
        </div>
        <div id="input-area" class="card no-print" style="display:none;">
            <h2 id="targetName">ì¸ë°”ë”” ì§€í‘œ ì…ë ¥</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input type="number" id="w" placeholder="ì²´ì¤‘">
                <input type="number" id="pa" placeholder="ìœ„ìƒê°">
                <input type="number" id="f" placeholder="ì²´ì§€ë°©">
                <input type="number" id="wa" placeholder="ì²´ìˆ˜ë¶„">
            </div>
            <button class="btn btn-blue" onclick="makeReport()">ë¶„ì„ ê²°ê³¼ ë³´ê¸°</button>
        </div>

        <div id="report" class="result-box">
            <h1 style="text-align:center; font-size:22px;">ì²´ì§ˆ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
            <p id="p-info" style="text-align:center; font-weight:bold; border-bottom:1px solid #eee; padding-bottom:10px;"></p>
            <div class="saju-grid" id="saju-res"></div>
            <div id="graph-res"></div>
            <div id="ment-res" style="background:#f0f7ff; padding:15px; border-radius:10px; margin-top:15px; line-height:1.6;"></div>
            <div id="atomy-res" style="background:#fff5f5; border:1px solid #feb2b2; padding:15px; border-radius:10px; margin-top:10px; font-weight:bold; color:var(--í™”);"></div>
            <button class="btn no-print" onclick="window.print()" style="background:#999; color:#white; margin-top:20px;">ì¸ì‡„í•˜ê¸°</button>
        </div>
    </section>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAUucRqU8nciqkINbjZcUUHx3UkR_OOprs", authDomain: "cheon1do-plus.firebaseapp.com", projectId: "cheon1do-plus", storageBucket: "cheon1do-plus.firebasestorage.app", messagingSenderId: "344900999016", appId: "1:344900999016:web:a20ef3b01df68ca03928dd" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let selectedUser = null;

    function showTab(n) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(n).classList.add('active');
        document.getElementById(n === 'register' ? 't-reg' : 't-con').classList.add('active');
        if(n === 'consult') loadList('consult-list');
    }

    async function saveData() {
        const name = document.getElementById('name').value;
        const saju = document.getElementById('saju_input').value;
        if(!name || !saju) return alert("ì„±í•¨ê³¼ ì‚¬ì£¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        const data = { name, saju, gender: document.getElementById('gender').value, symp: document.getElementById('symp').value, date: new Date() };
        await db.collection("clients").add(data);
        alert("âœ… " + name + "ë‹˜ ì ‘ìˆ˜ ì™„ë£Œ!");
        loadList('reg-check-list'); // ì ‘ìˆ˜ íƒ­ ëª©ë¡ ê°±ì‹ 
        document.getElementById('name').value = "";
        document.getElementById('saju_input').value = "";
    }

    async function loadList(id) {
        const snap = await db.collection("clients").orderBy("date", "desc").limit(5).get();
        const div = document.getElementById(id);
        div.innerHTML = "";
        snap.forEach(doc => {
            const d = doc.data();
            const b = document.createElement('div');
            b.className = "btn-list";
            b.innerHTML = `<span>${d.name}(${d.gender})</span> <span>${d.date.toDate().toLocaleTimeString()}</span>`;
            if(id === 'consult-list') {
                b.onclick = () => {
                    selectedUser = d;
                    document.getElementById('input-area').style.display = 'block';
                    document.getElementById('report').style.display = 'none';
                    document.getElementById('targetName').innerText = d.name + "ë‹˜ ì§€í‘œ ì…ë ¥";
                };
            }
            div.appendChild(b);
        });
    }

    const sMap = { 'ì‹ ':'è¾›','í•´':'äº¥','ê¸°':'å·±','ì„':'å£¬','ì¸':'å¯…','ìœ ':'é…‰','ì':'å­','ì¶•':'ä¸‘','ë³‘':'ä¸™','ì •':'ä¸','ë¬´':'æˆŠ','ê²½':'åºš','ì„':'ä¹™','ê°‘':'ç”²','ê³„':'ç™¸','ë¯¸':'æœª','ìˆ ':'æˆŒ','ì§„':'è¾°','ì‚¬':'å·³','ì˜¤':'åˆ','ë¬˜':'å¯' };
    const sCol = { 'è¾›':'ê¸ˆ','åºš':'ê¸ˆ','é…‰':'ê¸ˆ','ç”³':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜','äº¥':'ìˆ˜','å­':'ìˆ˜','ç”²':'ëª©','ä¹™':'ëª©','å¯…':'ëª©','å¯':'ëª©','ä¸™':'í™”','ä¸':'í™”','å·³':'í™”','åˆ':'í™”','æˆŠ':'í† ','å·±':'í† ','è¾°':'í† ','æˆŒ':'í† ','ì¶•':'í† ','ë¯¸':'í† ' };

    function makeReport() {
        if(!selectedUser) return;
        const hanjas = selectedUser.saju.split(' ').map(k => sMap[k] || k);
        const counts = { 'ëª©':0, 'í™”':0, 'í† ':0, 'ê¸ˆ':0, 'ìˆ˜':0 };
        hanjas.forEach(h => { if(sCol[h]) counts[sCol[h]]++; });

        document.getElementById('p-info').innerText = `${selectedUser.name} (${selectedUser.gender}) | ë¶ˆí¸: ${selectedUser.symp}`;
        
        // ì‚¬ì£¼ ì¹´ë“œ ì¶œë ¥
        const labels = ['ì‹œì£¼','ì¼ì£¼','ì›”ì£¼','ë…„ì£¼'];
        document.getElementById('saju-res').innerHTML = labels.map((l, i) => `
            <div class="saju-box"><small>${l}</small>
                <span class="saju-char" style="color:var(--${sCol[hanjas[i*2]]})">${hanjas[i*2]||''}</span>
                <span class="saju-char" style="color:var(--${sCol[hanjas[i*2+1]]})">${hanjas[i*2+1]||''}</span>
            </div>`).join('');

        // ê·¸ë˜í”„ ì¶œë ¥
        document.getElementById('graph-res').innerHTML = Object.entries(counts).map(([n, c]) => `
            <div style="display:flex; justify-content:space-between; font-size:12px;"><span>${n}</span><span>${c}ê°œ</span></div>
            <div class="bar-bg"><div class="bar-fill" style="width:${(c/8)*100}%; background:var(--${n})"></div></div>
        `).join('');

        const max = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
        const tips = { 'ìˆ˜': "ìˆ˜(æ°´) ê¸°ìš´ ê³¼ë‹¤: í•˜ì²´ ë¶€ì¢…ê³¼ ëƒ‰ì¦ ì£¼ì˜. ì‹¬ë¶€ ì˜¨ì—´ ìš”ë²• í•„ìˆ˜.", 'í™”': "í™”(ç«) ê¸°ìš´ ê³¼ë‹¤: ì‹¬ì¥ ì—´ê° ë° ìƒì—´ê° ì£¼ì˜. í˜ˆí–‰ ê°œì„  ê´€ë¦¬.", 'í† ': "í† (åœŸ) ê¸°ìš´ ê³¼ë‹¤: ì†Œí™”ê¸° ì •ì²´ ë° ë¬´ê¸°ë ¥ ì£¼ì˜. íš¨ì†Œ ì„­ì·¨ ê¶Œì¥.", 'ëª©': "ëª©(æœ¨) ê¸°ìš´ ê³¼ë‹¤: ê°„ í”¼ë¡œ ë° ê·¼ìœ¡ ê²½ì§ ì£¼ì˜. ìŠ¤íŠ¸ë ˆì¹­ê³¼ í•´ë….", 'ê¸ˆ': "ê¸ˆ(é‡‘) ê¸°ìš´ ê³¼ë‹¤: í˜¸í¡ê¸° ë° í”¼ë¶€ ê±´ì¡° ì£¼ì˜. ë©´ì—­ë ¥ ê°•í™”." };
        const atoms = { 'ìˆ˜': "ì¶”ì²œ: í—¤ëª¨í˜, í™ì‚¼ë‹¨, ë³´ì´ì°¨", 'í™”': "ì¶”ì²œ: ì˜¤ë©”ê°€3, ë½í‹°ì›€", 'í† ': "ì¶”ì²œ: íŒŒì¸ìì„, ì°¨ì „ìí”¼", 'ëª©': "ì¶”ì²œ: ë°€í¬ì”¨ìŠ¬, ë¹„íƒ€ë¯¼B", 'ê¸ˆ': "ì¶”ì²œ: ë…¸ë‹ˆ, ë¹„íƒ€ë¯¼C" };

        document.getElementById('ment-res').innerHTML = `<b>ì²´ì§ˆ ë¶„ì„ ê²°ê³¼:</b><br>${tips[max]}<br><br>ìœ„ìƒê° ${document.getElementById('pa').value}Â°ëŠ” ì„¸í¬ ê±´ê°•ì˜ ì§€í‘œì…ë‹ˆë‹¤. ê¾¸ì¤€í•œ ì˜¨ì—´ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.`;
        document.getElementById('atomy-res').innerText = "ğŸ’Š ì• í„°ë¯¸ ë§ì¶¤ ì²˜ë°©: " + atoms[max];
        document.getElementById('report').style.display = 'block';
    }
    
    // ì´ˆê¸° ëª©ë¡ ë¡œë“œ
    window.onload = () => loadList('reg-check-list');
</script>
</body>
</html>
