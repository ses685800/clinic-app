<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²œì¼ë„+ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ v3.0</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --accent: #e74c3c; --bg: #f8f9fa; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        nav { background: var(--primary); color: white; padding: 15px; display: flex; gap: 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .nav-item { cursor: pointer; padding: 10px 20px; border-radius: 5px; font-weight: bold; }
        .nav-item.active { background: var(--secondary); }
        .container { max-width: 900px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h2 { color: var(--primary); border-left: 6px solid var(--secondary); padding-left: 12px; margin-top: 0; font-size: 20px; }
        .q-text { font-weight: 500; margin-bottom: 8px; color: #444; display: block; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; margin-bottom: 15px; background: #fff; }
        .btn { background: var(--secondary); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 16px; width: 100%; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: #2980b9; }
        .btn-list { background: #34495e; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn-list:hover { background: #2c3e50; }
        .time-label { font-size: 12px; opacity: 0.8; font-weight: normal; }
        .view-section { display: none; }
        .view-section.active { display: block; }

        /* ë¦¬í¬íŠ¸ ë° ì¶œë ¥ ìŠ¤íƒ€ì¼ */
        .result-box { background: #fff; border: 3px solid var(--primary); padding: 30px; border-radius: 20px; margin-top: 20px; line-height: 1.6; }
        .saju-badge-container { display: flex; gap: 8px; justify-content: center; margin-bottom: 20px; }
        .saju-badge { background: #fff; padding: 8px 12px; border-radius: 8px; font-size: 22px; font-weight: bold; border: 1px solid #ddd; }
        .code-banner { background: var(--accent); color: white; padding: 15px; border-radius: 10px; text-align: center; font-size: 26px; font-weight: 800; margin: 15px 0; }
        .section-box { border-radius: 12px; padding: 18px; margin-bottom: 15px; border: 1px solid #eee; }
        .habit-box { background: #fff9db; border: 2px solid #fab005; }
        .tea-box { background: #fdf2e9; border: 2px solid #f0b27a; }
        .box-title { font-weight: bold; font-size: 18px; margin-bottom: 8px; color: #d35400; }
        .footer-msg { text-align: center; font-weight: bold; font-size: 18px; border-top: 2px dashed #ddd; padding-top: 20px; color: var(--primary); margin-top: 25px; }

        @media print {
            nav, .btn, .no-print, h2, #search-area { display: none !important; }
            .container { max-width: 100%; margin: 0; padding: 0; }
            .result-box { border: 2px solid #000; border-radius: 0; }
        }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" id="nav-reg" onclick="showTab('register')">1. ê³ ê°ì ‘ìˆ˜</div>
    <div class="nav-item" id="nav-con" onclick="showTab('consult')">2. ìƒë‹´ì‹¤</div>
</nav>

<div class="container">
    <section id="register" class="view-section active">
        <div class="card">
            <h2>ì‹ ê·œ ê³ ê° ë¬¸ì§„</h2>
            <input type="text" id="name" placeholder="ê³ ê° ì„±í•¨ ì…ë ¥">
            <input type="text" id="saju_ko" placeholder="ì‚¬ì£¼ì›êµ­ (ì˜ˆ: ì‹ í•´ ê¸°í•´ ì„ì¸ ê¸°ìœ )">
            
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
            
            <label class="q-text">Q1. ëª©(W): ì–´ê¹¨ë‚˜ ëª© ê·¼ìœ¡ì´ ìì£¼ ë»£ë»£í•˜ê²Œ ë­‰ì¹˜ì‹œë‚˜ìš”?</label>
            <select id="w_val">
                <option value="1">ì „í˜€ ì•„ë‹ˆì—ìš” (í¸ì•ˆí•¨)</option>
                <option value="3" selected>ê°€ë” ê·¸ë˜ìš” (ë³´í†µ)</option>
                <option value="5">ë„ˆë¬´ ì‹¬í•´ìš” (ë¶ˆí¸í•¨)</option>
            </select>

            <label class="q-text">Q2. í™”(H): ì–¼êµ´ë¡œ ì—´ì´ ì˜¤ë¥´ê±°ë‚˜ ê°€ìŠ´ì´ ë‹µë‹µí•˜ê³  ë‘ê·¼ê±°ë¦¬ì‹œë‚˜ìš”?</label>
            <select id="h_val">
                <option value="1">ì „í˜€ ì•„ë‹ˆì—ìš” (í¸ì•ˆí•¨)</option>
                <option value="3" selected>ê°€ë” ê·¸ë˜ìš” (ë³´í†µ)</option>
                <option value="5">ë„ˆë¬´ ì‹¬í•´ìš” (ë¶ˆí¸í•¨)</option>
            </select>

            <label class="q-text">Q3. í† (T): ì†ì´ ìì£¼ ë”ë¶€ë£©í•˜ê±°ë‚˜ ìƒê°ì´ ë§ì•„ ì†Œí™”ê°€ ì•ˆ ë˜ì‹œë‚˜ìš”?</label>
            <select id="t_val">
                <option value="1">ì „í˜€ ì•„ë‹ˆì—ìš” (í¸ì•ˆí•¨)</option>
                <option value="3" selected>ê°€ë” ê·¸ë˜ìš” (ë³´í†µ)</option>
                <option value="5">ë„ˆë¬´ ì‹¬í•´ìš” (ë¶ˆí¸í•¨)</option>
            </select>

            <label class="q-text">Q4. ê¸ˆ(M): ê°ê¸°ì— ìì£¼ ê±¸ë¦¬ê±°ë‚˜ í”¼ë¶€ê°€ ì˜ˆë¯¼í•˜ê³  ê±´ì¡°í•˜ì‹  í¸ì¸ê°€ìš”?</label>
            <select id="m_val">
                <option value="1">ì „í˜€ ì•„ë‹ˆì—ìš” (í¸ì•ˆí•¨)</option>
                <option value="3" selected>ê°€ë” ê·¸ë˜ìš” (ë³´í†µ)</option>
                <option value="5">ë„ˆë¬´ ì‹¬í•´ìš” (ë¶ˆí¸í•¨)</option>
            </select>

            <label class="q-text">Q5. ìˆ˜(S): ëª¸ì´ë‚˜ ì–¼êµ´ì´ ìì£¼ ë¶“ê³  ì†ë°œì´ ì°¨ê°‘ê²Œ ëŠê»´ì§€ì‹œë‚˜ìš”?</label>
            <select id="s_val">
                <option value="1">ì „í˜€ ì•„ë‹ˆì—ìš” (í¸ì•ˆí•¨)</option>
                <option value="3" selected>ê°€ë” ê·¸ë˜ìš” (ë³´í†µ)</option>
                <option value="5">ë„ˆë¬´ ì‹¬í•´ìš” (ë¶ˆí¸í•¨)</option>
            </select>

            <button class="btn" onclick="saveCustomer()">ë°ì´í„° ì „ì†¡ ë° ìƒë‹´ì‹¤ë¡œ ë³´ë‚´ê¸°</button>
        </div>
    </section>

    <section id="consult" class="view-section">
        <div class="card no-print">
            <h2>ì˜¤ëŠ˜ì˜ ëŒ€ê¸° ê³ ê° (ìµœê·¼ ì ‘ìˆ˜ìˆœ)</h2>
            <div id="recent-list" style="margin-bottom: 20px;">
                <p style="color: #666; font-size: 14px;">ì ‘ìˆ˜ëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            
            <div id="search-area" style="border-top: 1px solid #eee; pt: 15px;">
                <p style="font-size: 13px; color: #888;">ì˜ˆì „ ê¸°ë¡ ì°¾ê¸°:</p>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="searchName" placeholder="ì„±í•¨ ì…ë ¥" style="margin-bottom:0;">
                    <button class="btn" style="width:100px; padding:10px;" onclick="searchCustomer()">ê²€ìƒ‰</button>
                </div>
            </div>
        </div>

        <div id="consult-area" style="display:none;">
            <div class="card no-print">
                <h2 id="targetDisplay">ê³ ê° ë¶„ì„ ì¤‘...</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="number" id="in1" placeholder="ì „ ì¸ë°”ë””">
                    <input type="number" id="in2" placeholder="í›„ ì¸ë°”ë””">
                </div>
                <button class="btn" style="background:#27ae60; margin-top:10px;" onclick="generateReport()">í†µí•© ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±</button>
                <button class="btn" style="background:#95a5a6; margin-top:10px;" onclick="window.print()">ğŸ–¨ï¸ ë¦¬í¬íŠ¸ ì¸ì‡„</button>
            </div>

            <div id="final-report" class="result-box" style="display:none;">
                <div class="saju-badge-container" id="saju-hanja"></div>
                <div class="code-banner" id="res-code"></div>

                <div class="section-box tea-box">
                    <div class="box-title">ğŸµ ì›°ì»´ ë¶€ìŠ¤í„°: í™ì‚¼ë‹¨ ì˜¨ìˆ˜</div>
                    <div id="res-tea"></div>
                </div>
                
                <div class="section-box habit-box">
                    <div class="box-title">ğŸ”® ìš´ëª…ì„ ë°”ê¾¸ëŠ” ë§ˆìŒ ìŠµê´€</div>
                    <div id="res-mind" style="font-size: 17px;"></div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="section-box" style="background:#f8f9fa;"><strong>ğŸ¯ í…Œë¼í”¼ ì²˜ë°©</strong><br><span id="res-therapy"></span></div>
                    <div class="section-box" style="background:#f8f9fa;"><strong>ğŸ’Š ì• í„°ë¯¸ ì˜ì–‘</strong><br><span id="res-atomy"></span></div>
                </div>

                <div class="section-box" style="background:#eef7ff; border-color:#3498db;">
                    <div class="box-title" style="color:#2980b9;">ğŸ’¡ ì†¡ì€ìˆ™ ì›ì¥ë‹˜ì˜ ì „ë¬¸ ì§„ë‹¨</div>
                    <div id="res-ment"></div>
                </div>

                <div class="footer-msg">"ì²´ì˜¨ 1ë„ê°€ ë‹¹ì‹ ì˜ ìš´ëª…ì„ ë°”ê¿‰ë‹ˆë‹¤."</div>
            </div>
        </div>
    </section>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAUucRqU8nciqkINbjZcUUHx3UkR_OOprs", authDomain: "cheon1do-plus.firebaseapp.com", projectId: "cheon1do-plus", storageBucket: "cheon1do-plus.firebasestorage.app", messagingSenderId: "344900999016", appId: "1:344900999016:web:a20ef3b01df68ca03928dd" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let currentCustomer = null;

    function showTab(t) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        document.getElementById(t === 'register' ? 'nav-reg' : 'nav-con').classList.add('active');
        if(t === 'consult') loadRecentCustomers();
    }

    async function saveCustomer() {
        const name = document.getElementById('name').value;
        if(!name) return alert("ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        const scores = { W: document.getElementById('w_val').value, H: document.getElementById('h_val').value, T: document.getElementById('t_val').value, M: document.getElementById('m_val').value, S: document.getElementById('s_val').value };
        await db.collection("clients").add({ name, saju_ko: document.getElementById('saju_ko').value, scores, createdAt: new Date() });
        
        alert(name + "ë‹˜ ì ‘ìˆ˜ ì™„ë£Œ! ìƒë‹´ì‹¤ ëª©ë¡ì—ì„œ í™•ì¸í•˜ì„¸ìš”.");
        document.getElementById('name').value = "";
        document.getElementById('saju_ko').value = "";
        showTab('consult');
    }

    async function loadRecentCustomers() {
        const snap = await db.collection("clients").orderBy("createdAt", "desc").limit(5).get();
        const listDiv = document.getElementById('recent-list');
        listDiv.innerHTML = "";
        if(snap.empty) listDiv.innerHTML = "<p>ëŒ€ê¸° ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        snap.forEach(doc => {
            const data = doc.data();
            const time = data.createdAt ? data.createdAt.toDate().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : "";
            listDiv.innerHTML += `<button class="btn btn-list" onclick="selectCustomer('${doc.id}', '${data.name}', '${data.saju_ko}', ${JSON.stringify(data.scores)})">
                <span>${data.name} ë‹˜</span> <span class="time-label">${time} ì ‘ìˆ˜</span>
            </button>`;
        });
    }

    async function searchCustomer() {
        const snap = await db.collection("clients").where("name", "==", document.getElementById('searchName').value).get();
        const listDiv = document.getElementById('recent-list');
        listDiv.innerHTML = "<h4>ê²€ìƒ‰ ê²°ê³¼:</h4>";
        snap.forEach(doc => {
            listDiv.innerHTML += `<button class="btn btn-list" onclick="selectCustomer('${doc.id}', '${doc.data().name}', '${doc.data().saju_ko}', ${JSON.stringify(doc.data().scores)})">${doc.data().name} ì„ íƒ</button>`;
        });
    }

    function selectCustomer(id, name, saju, scores) {
        currentCustomer = { id, name, saju, scores };
        document.getElementById('consult-area').style.display = 'block';
        document.getElementById('targetDisplay').innerText = name + "ë‹˜ ë¶„ì„ ë¦¬í¬íŠ¸";
        document.getElementById('final-report').style.display = 'none';
        window.scrollTo(0, document.getElementById('consult-area').offsetTop);
    }

    const hanjaMap = {'ì‹ ':'è¾›','í•´':'äº¥','ê¸°':'å·±','ì„':'å£¬','ì¸':'å¯…','ìœ ':'é…‰','ì':'å­','ì¶•':'ä¸‘','ë³‘':'ä¸™','ì •':'ä¸','ë¬´':'æˆŠ','ê²½':'åºš','ì„':'ä¹™','ê°‘':'ç”²','ê³„':'ç™¸','ë¯¸':'æœª','ìˆ ':'æˆŒ','ì§„':'è¾°','ì‚¬':'å·³','ì˜¤':'åˆ','ë¬˜':'å¯'};

    function generateReport() {
        const s = currentCustomer.scores;
        const maxO = Object.keys(s).reduce((a, b) => parseInt(s[a]) > parseInt(s[b]) ? a : b);
        let res = {};

        if(maxO === 'S') {
            res = { code: "S3R ìˆ˜ì •ì²´ ìˆœí™˜í˜•", therapy: "ì˜¨ì—´ 40ë¶„ + ì›¨ì´ë¸Œ 20ë¶„", atomy: "í—¤ëª¨í˜, ì˜¤ë©”ê°€3, ë³´ì´ì°¨", tea: "ì‚¬ì£¼ì— ìˆ˜ë…(æ°´)ì´ ë§ì•„ ì†ì´ ëƒ‰í•©ë‹ˆë‹¤. í™ì‚¼ë‹¨ì˜ ë”°ëœ»í•œ ì„±ì§ˆë¡œ ì†ë¶ˆì„ ì§€í´ì•¼ ë…¸íë¬¼ì´ ì˜ ë¹ ì§‘ë‹ˆë‹¤.", mind: "<b>[ë°©ì¶œì˜ ìŠµê´€]</b> í˜¼ì ì°¸ëŠ” ìŠµê´€ì´ ëª¸ì„ ë¶“ê²Œ í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ëª¨ë“  ê³ ë¯¼ì„ ë•€ê³¼ í•¨ê»˜ ë°°ì¶œí•˜ì„¸ìš”.", ment: "ê¸°í˜ˆì˜ í˜ìœ¼ë¡œ ìˆ˜ë…ì„ ë°€ì–´ë‚¼ ë•Œ ì§„ì§œ ìˆœí™˜ì´ ì‹œì‘ë©ë‹ˆë‹¤." };
        } else if(maxO === 'T') {
            res = { code: "T3M í† ì •ì²´ ì†Œí™”í˜•", therapy: "ì˜¨ì—´ 30ë¶„ + ì›¨ì´ë¸Œ 30ë¶„", atomy: "í—¤ëª¨í˜, ìœ ì‚°ê· , íŒŒì¸ìì„", tea: "ìƒê°ì´ ë§ì•„ ì •ì²´ëœ ê¸°ìš´ì„ í™ì‚¼ì˜ ì˜¨ê¸°ë¡œ ê¹¨ì›Œì¤ë‹ˆë‹¤. ìœ„ì¥ ìš´ë™ì„ ë•ëŠ” ë§ˆì¤‘ë¬¼ì…ë‹ˆë‹¤.", mind: "<b>[ë¹„ì›€ì˜ ìŠµê´€]</b> ì™„ë²½í•˜ë ¤ëŠ” ìƒê°ì´ ìœ„ì¥ì„ ë©ˆì¶”ê²Œ í•©ë‹ˆë‹¤. ë‡Œë¥¼ ì‰¬ê²Œ í•˜ëŠ” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.", ment: "ì†ì´ í¸ì•ˆí•´ì§€ë©´ ì–¼êµ´ì˜ ë…ì†Œì™€ ë¶“ê¸°ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ë¼ì§‘ë‹ˆë‹¤." };
        } else if(maxO === 'W') {
            res = { code: "W1N ëª©ê³¼ë‹¤ ê¸´ì¥í˜•", therapy: "ì˜¨ì—´ 40ë¶„ (ì €ê°•ë„ ì´ì™„)", atomy: "í—¤ëª¨í˜, ì¹¼ë§ˆë””, ë½í‹°ì›€", tea: "ê¸´ì¥ëœ ê°„ ê¸°ìš´ì„ ë¶€ë“œëŸ½ê²Œ ì´ì™„ì‹œí‚¤ëŠ” í™ì‚¼ ì²˜ë°©ì…ë‹ˆë‹¤. ëª¸ì„ ìœ ì—°í•˜ê²Œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.", mind: "<b>[ì´ì™„ì˜ ìŠµê´€]</b> ì±…ì„ê°ì„ ì ì‹œ ë‚´ë ¤ë†“ìœ¼ì„¸ìš”. ì–´ê¹¨ì˜ ì§ì„ ëœì–´ì•¼ ìš´ì˜ í†µë¡œê°€ ì—´ë¦½ë‹ˆë‹¤.", ment: "ê¸´ì¥ì´ í’€ë ¤ì•¼ ì²´ì˜¨ì´ ì˜¤ë¥´ê³  ë©´ì—­ì„¸í¬ê°€ í™œì„±í™”ë©ë‹ˆë‹¤." };
        } else {
            res = { code: "M2R ê¸ˆí—ˆ ë©´ì—­í˜•", therapy: "ì˜¨ì—´ 40ë¶„ + ì›¨ì´ë¸Œ 20ë¶„", atomy: "í—¤ëª¨í˜, ë¹„íƒ€ë¯¼C, ìœ ì‚°ê· ", tea: "ì•½í•´ì§„ ë°©ì–´ ê¸°ìš´ì„ ì±„ìš°ëŠ” ëª…í’ˆ í™ì‚¼ì°¨ì…ë‹ˆë‹¤. ì‹¬ë¶€ ì˜¨ë„ë¥¼ ì˜¬ë ¤ ë©´ì—­ë ¥ì„ ë³´í˜¸í•˜ì„¸ìš”.", mind: "<b>[ë³´í˜¸ì˜ ìŠµê´€]</b> ì™¸ë¶€ ìê·¹ì— ì˜ˆë¯¼í•œ ê¸°ì§ˆì…ë‹ˆë‹¤. ë‚´ë©´ì˜ ë‹¨ë‹¨í•œ ì¤‘ì‹¬ì„ ì„¸ìš°ëŠ” ê²ƒì´ ìš°ì„ ì…ë‹ˆë‹¤.", ment: "ë¬´ë„ˆì§„ ë©´ì—­ë²½ì„ í—¤ëª¨í˜ê³¼ ì˜¨ì—´ë¡œ ë‹¤ì‹œ ê²¬ê³ í•˜ê²Œ ì„¸ì›ë‹ˆë‹¤." };
        }

        document.getElementById('res-code').innerText = res.code;
        document.getElementById('res-tea').innerText = res.tea;
        document.getElementById('res-mind').innerHTML = res.mind;
        document.getElementById('res-therapy').innerText = res.therapy;
        document.getElementById('res-atomy').innerText = res.atomy;
        document.getElementById('res-ment').innerText = res.ment;

        const hanjaHTML = (currentCustomer.saju || "").split(' ').map(s => `<div class="saju-badge">${hanjaMap[s] || s}</div>`).join('');
        document.getElementById('saju-hanja').innerHTML = hanjaHTML;
        document.getElementById('final-report').style.display = 'block';
    }
</script>
</body>
</html>
